<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>地震TRPGシナリオ — マタタビクリニック院長の一日</title>
  <link rel="apple-touch-icon" href="doctor_cat.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="災害への備えをプライマリ・ケア診療に活かす">
  <meta name="description" content="プライマリ・ケア従事者のための災害医療ワークショップ。シナリオ体験を通じて、災害時の対応力を身につけましょう。">
  <!-- OGP -->
  <meta property="og:title" content="災害への備えをプライマリ・ケア診療に活かす">
  <meta property="og:description" content="プライマリ・ケア従事者のための災害医療ワークショップ。シナリオ体験を通じて、災害時の対応力を身につけましょう。">
  <meta property="og:image" content="https://shoei05.github.io/trpg/ogp.png">
  <meta property="og:url" content="https://shoei05.github.io/trpg">
  <meta property="og:type" content="website">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="災害への備えをプライマリ・ケア診療に活かす">
  <meta name="twitter:description" content="プライマリ・ケア従事者のための災害医療ワークショップ">
  <meta name="twitter:image" content="https://shoei05.github.io/trpg/ogp.png">
  <style>
    /* ===== RESET & BASE ===== */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      /* Palette */
      --primary: #5A67D8;
      /* Indigo base */
      --primary-dark: #434190;
      --secondary: #2DD4BF;
      /* Teal highlight */
      --accent: #F97316;
      /* Orange active highlight */
      --bg-dark: #0F172A;
      /* Slate 900 */
      --bg-gradient: linear-gradient(135deg, #1E293B, #0F172A);
      --surface: rgba(255, 255, 255, 0.95);
      --surface-glass: rgba(255, 255, 255, 0.08);
      --text-main: #111827;
      --text-muted: #6B7280;
      --text-light: #F1F5F9;
      --orange: #FF6B35;
      --yellow: #FFD166;
      --red: #EF4444;
      --green: #10B981;
      --blue: #118AB2;
      --bubble-left: #FFFFFF;
      --bubble-right: #E0E7FF;
      --font-main: 'Zen Kaku Gothic New', "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
    }

    html,
    body {
      height: 100%;
      font-family: var(--font-main);
      background: #0f172a;
      color: var(--text-main);
      -webkit-text-size-adjust: 100%;
      overflow-x: hidden;
      overflow-y: auto;
    }

    /* ===== SCREEN SYSTEM ===== */
    .screen {
      display: none;
      position: relative;
      width: 100%;
      min-height: 100vh;
      min-height: 100dvh;
      height: 100vh;
      height: 100dvh;
      overflow-x: clip;
      overflow-y: auto;
      overscroll-behavior-y: auto;
      background: var(--bg-gradient);
    }

    @supports (-webkit-touch-callout: none) {
      .screen {
        min-height: 100svh;
        height: 100svh;
      }
    }

    .screen.active {
      display: flex;
      flex-direction: column;
    }

    /* Wrap to simulate mobile view on desktop */
    #app-container {
      width: 100%;
      max-width: 480px;
      /* iPhone width approx */
      background: var(--bg-dark);
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
      min-height: 100vh;
      max-height: 100vh;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
    }

    /* ===== PROGRESS BAR ===== */
    #progress-bar-wrap {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: rgba(255, 255, 255, 0.2);
      z-index: 1000;
      display: none;
    }

    #progress-bar-wrap.visible {
      display: block;
    }

    #progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--orange), var(--yellow));
      transition: width 0.4s ease;
    }

    /* ===== ACT LABEL ===== */
    .act-label {
      position: fixed;
      top: 10px;
      right: 56px;
      background: rgba(29, 29, 44, 0.8);
      color: var(--yellow);
      font-size: 11px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 20px;
      z-index: 999;
      letter-spacing: 0.5px;
      display: none;
    }

    .act-label.visible {
      display: block;
    }

    /* ===== JUMP MENU ===== */
    .menu-toggle-btn {
      position: fixed;
      top: 12px;
      right: 10px;
      width: 38px;
      height: 38px;
      border: none;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.8);
      color: white;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      z-index: 1200;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
    }

    .jump-menu-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
      z-index: 1190;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .jump-menu-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .jump-menu {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: min(340px, 84vw);
      background: #FFFFFF;
      z-index: 1210;
      transform: translateX(-100%);
      transition: transform 0.22s ease;
      box-shadow: 8px 0 24px rgba(15, 23, 42, 0.22);
      display: flex;
      flex-direction: column;
    }

    .jump-menu.open {
      transform: translateX(0);
    }

    .jump-menu-header {
      padding: 16px;
      background: linear-gradient(135deg, #1D4ED8, #2563EB);
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .jump-menu-title {
      font-size: 16px;
      font-weight: 900;
      letter-spacing: 0.3px;
    }

    .jump-menu-close {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
    }

    .jump-menu-body {
      padding: 12px;
      overflow-y: auto;
      flex: 1;
      background: #F8FAFC;
    }

    .jump-group {
      background: white;
      border: 1px solid #E5E7EB;
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 10px;
    }

    .jump-group-title {
      font-size: 11px;
      font-weight: 800;
      color: #64748B;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .jump-item {
      width: 100%;
      border: none;
      background: #F1F5F9;
      color: #0F172A;
      font-size: 13px;
      text-align: left;
      padding: 10px 12px;
      border-radius: 10px;
      margin-bottom: 6px;
      cursor: pointer;
      line-height: 1.4;
    }

    .jump-item:last-child {
      margin-bottom: 0;
    }

    .jump-item:active {
      transform: scale(0.98);
      background: #E2E8F0;
    }

    .jump-item-primary {
      background: linear-gradient(135deg, var(--accent), #EA580C);
      color: white;
      font-weight: 800;
      border: 1px solid rgba(234, 88, 12, 0.35);
      box-shadow: 0 6px 18px rgba(234, 88, 12, 0.28);
      margin-bottom: 10px;
    }

    .jump-item-primary:active {
      background: linear-gradient(135deg, #EA580C, #C2410C);
    }

    .jump-item-door {
      border-left: 4px solid #F97316;
      background: #FFF7ED;
      font-weight: 800;
    }

    /* ===== TITLE SCREEN ===== */
    #screen-title {
      background: linear-gradient(145deg, #1E1B4B 0%, var(--bg-dark) 100%);
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
    }

    #screen-title::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 50% 30%, rgba(90, 103, 216, 0.2), transparent 60%);
      pointer-events: none;
    }

    .title-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 24px;
      max-width: 480px;
      margin: 0 auto;
      width: 100%;
      z-index: 10;
      position: relative;
    }

    .workshop-label {
      background: transparent;
      color: var(--secondary);
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 2px;
      margin-bottom: 24px;
      text-transform: uppercase;
    }

    .title-cat {
      font-size: 80px;
      margin-bottom: 16px;
      filter: drop-shadow(0 4px 12px rgba(255, 107, 53, 0.4));
    }

    .title-main {
      font-size: 32px;
      font-weight: 900;
      color: white;
      text-align: center;
      line-height: 1.25;
      margin-bottom: 16px;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #FFFFFF, #E2E8F0);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .title-sub {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
      text-align: center;
      margin-bottom: 32px;
      line-height: 1.6;
    }

    .char-card {
      background: var(--surface-glass);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 24px;
      width: 100%;
      margin-bottom: 32px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .char-card-title {
      font-size: 12px;
      color: var(--secondary);
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 12px;
      text-transform: uppercase;
    }

    .char-name {
      font-size: 20px;
      font-weight: 900;
      color: white;
      margin-bottom: 4px;
    }

    .char-name-sub {
      font-size: 12px;
      color: #94A3B8;
      margin-bottom: 12px;
    }

    .char-desc {
      font-size: 13px;
      color: #CBD5E1;
      line-height: 1.7;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      padding-top: 12px;
    }

    .time-badge {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 16px;
      padding: 16px;
      width: 100%;
      margin-bottom: 40px;
    }

    .time-badge .icon {
      font-size: 24px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }

    .time-badge .text {
      font-size: 13px;
      color: #FECACA;
      line-height: 1.5;
    }

    .time-badge .text strong {
      color: #FCA5A5;
      font-size: 14px;
    }

    .btn-start {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, var(--accent), #EA580C);
      color: white;
      font-size: 18px;
      font-weight: 900;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      letter-spacing: 1px;
      box-shadow: 0 8px 24px rgba(234, 88, 12, 0.4);
      transition: all 0.2s ease;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .btn-start:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(234, 88, 12, 0.5);
    }

    .btn-start:active {
      transform: scale(0.98);
      box-shadow: 0 4px 12px rgba(234, 88, 12, 0.3);
    }

    /* ===== NEWS SCREEN ===== */
    #screen-news {
      background: #111;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .news-inner {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 20px calc(20px + env(safe-area-inset-bottom));
    }

    .tv-frame {
      background: #222;
      border: 3px solid #444;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .tv-header {
      background: #CC0000;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tv-channel {
      color: white;
      font-size: 12px;
      font-weight: 900;
      letter-spacing: 1px;
    }

    .tv-live {
      background: #FF0000;
      color: white;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 4px;
      animation: blink 1s infinite;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.4;
      }
    }

    .tv-screen {
      background: linear-gradient(180deg, #1a2a4a 0%, #0a0a1a 100%);
      padding: 20px;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .tv-breaking {
      background: var(--red);
      color: white;
      font-size: 13px;
      font-weight: 700;
      padding: 4px 10px;
      display: inline-block;
      margin-bottom: 12px;
      border-radius: 4px;
    }

    .tv-headline {
      font-size: 20px;
      font-weight: 900;
      color: white;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .tv-body {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.8;
    }

    .tv-ticker {
      background: var(--orange);
      overflow: hidden;
      padding: 8px 0;
    }

    .tv-ticker-inner {
      white-space: nowrap;
      animation: ticker 20s linear infinite;
      color: white;
      font-size: 13px;
      font-weight: 700;
      padding-left: 100%;
    }

    @keyframes ticker {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    .news-detail {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .news-detail h3 {
      font-size: 13px;
      color: var(--yellow);
      font-weight: 700;
      margin-bottom: 10px;
    }

    .news-detail ul {
      list-style: none;
      padding: 0;
    }

    .news-detail ul li {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      padding: 4px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      line-height: 1.6;
    }

    .news-detail ul li::before {
      content: "▶ ";
      color: var(--orange);
    }

    .news-detail ul li:last-child {
      border-bottom: none;
    }

    .btn-news-next {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #CC0000, var(--orange));
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(204, 0, 0, 0.3);
    }

    /* ===== CHAT SCREEN ===== */
    #screen-chat {
      background: var(--chat-bg);
      overflow: hidden;
    }

    #screen-chat.active {
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      background: #075E54;
      padding: 12px 16px;
      padding-top: max(12px, env(safe-area-inset-top));
      display: flex;
      align-items: center;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .chat-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--orange), #FF8C5A);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }

    .chat-header-info {
      flex: 1;
    }

    .chat-header-name {
      font-size: 16px;
      font-weight: 700;
      color: white;
    }

    .chat-header-sub {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
    }

    .chat-body {
      padding: 16px 12px;
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }

    .chat-date-label {
      text-align: center;
      margin: 12px 0;
    }

    .chat-date-label span {
      background: rgba(0, 0, 0, 0.2);
      color: white;
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 10px;
    }

    .chat-scene-label {
      text-align: center;
      margin: 20px 0 12px;
    }

    .chat-scene-label span {
      background: var(--orange);
      color: white;
      font-size: 12px;
      font-weight: 700;
      padding: 6px 16px;
      border-radius: 20px;
      box-shadow: 0 3px 10px rgba(255, 107, 53, 0.3);
    }

    /* Bubbles */
    .bubble-wrap {
      display: flex;
      margin-bottom: 12px;
      align-items: flex-start;
      gap: 8px;
    }

    .bubble-wrap.right {
      flex-direction: row-reverse;
    }

    .bubble-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
      background: #ddd;
    }

    .bubble-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      display: block;
    }

    .bubble-avatar.narrator {
      background: linear-gradient(135deg, #4a9eda, #2980b9);
    }

    .bubble-avatar.nanta {
      background: linear-gradient(135deg, var(--orange), #FF8C5A);
    }

    .bubble-avatar.staff {
      background: linear-gradient(135deg, #06D6A0, #05b386);
    }

    .bubble-avatar.patient {
      background: linear-gradient(135deg, #8B5CF6, #7c3aed);
    }

    .bubble-avatar.system {
      background: linear-gradient(135deg, #E63946, #cc2f3b);
    }

    .bubble-content {
      max-width: calc(100% - 50px);
    }

    .bubble-sender {
      font-size: 11px;
      color: var(--gray);
      margin-bottom: 4px;
      padding-left: 4px;
    }

    .bubble {
      display: inline-block;
      padding: 10px 14px;
      border-radius: 18px;
      font-size: 14px;
      line-height: 1.6;
      max-width: 100%;
      position: relative;
      word-break: break-word;
    }

    .bubble.left {
      background: var(--bubble-left);
      border-top-left-radius: 4px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .bubble.right {
      background: var(--bubble-right);
      border-top-right-radius: 4px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .bubble.system-msg {
      background: rgba(230, 57, 70, 0.1);
      border: 1px solid rgba(230, 57, 70, 0.3);
      border-radius: 12px;
      color: var(--red);
      font-weight: 600;
      font-size: 13px;
    }

    .bubble-time {
      font-size: 10px;
      color: var(--gray);
      margin-top: 4px;
      padding-left: 4px;
    }

    .bubble-wrap.right .bubble-time {
      text-align: right;
      padding-left: 0;
      padding-right: 4px;
    }

    /* Typing indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .typing-indicator.visible {
      opacity: 1;
    }

    .typing-dots {
      background: white;
      border-radius: 18px;
      border-top-left-radius: 4px;
      padding: 10px 14px;
      display: flex;
      gap: 4px;
      align-items: center;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .typing-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #aaa;
      animation: typingBounce 1.2s ease infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingBounce {

      0%,
      60%,
      100% {
        transform: translateY(0);
      }

      30% {
        transform: translateY(-8px);
      }
    }

    /* Choice area */
    .choice-area {
      background: var(--surface);
      border-top: 1px solid rgba(0, 0, 0, 0.05);
      padding: 20px 16px;
      padding-bottom: max(20px, env(safe-area-inset-bottom));
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.04);
      flex-shrink: 0;
      max-height: 55vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .choice-label {
      font-size: 14px;
      font-weight: 800;
      color: var(--primary-dark);
      margin-bottom: 12px;
      text-align: center;
    }

    .choice-btn {
      width: 100%;
      padding: 16px 18px;
      margin-bottom: 10px;
      background: white;
      border: 2px solid #E2E8F0;
      border-radius: 16px;
      font-size: 14px;
      color: var(--text-main);
      cursor: pointer;
      text-align: left;
      line-height: 1.5;
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
    }

    .choice-btn:hover {
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(90, 103, 216, 0.15);
      transform: translateY(-2px);
    }

    .choice-btn:active {
      transform: scale(0.98);
    }

    .choice-letter {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #F1F5F9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 800;
      flex-shrink: 0;
      color: var(--text-muted);
      transition: background 0.2s, color 0.2s;
    }

    /* Keep choices visually neutral before selection to avoid hinting answers. */
    .choice-btn.best,
    .choice-btn.ok,
    .choice-btn.great,
    .choice-btn.rethink {
      border-color: #E2E8F0;
      background: white;
    }

    .choice-btn.best .choice-letter,
    .choice-btn.ok .choice-letter,
    .choice-btn.great .choice-letter,
    .choice-btn.rethink .choice-letter {
      background: #F1F5F9;
      color: var(--text-muted);
    }

    /* ===== RESULT SCREEN ===== */
    #screen-result {
      background: var(--light-gray);
      min-height: 100vh;
      flex-direction: column;
      overflow-y: auto;
    }

    .result-header {
      padding: 20px 16px 12px;
      background: white;
      border-bottom: 1px solid #E5E7EB;
    }

    .result-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .result-badge.great {
      background: rgba(6, 214, 160, 0.15);
      color: #059669;
    }

    .result-badge.good {
      background: rgba(255, 209, 102, 0.2);
      color: #D97706;
    }

    .result-badge.rethink {
      background: rgba(229, 57, 70, 0.1);
      color: var(--red);
    }

    .result-title {
      font-size: 20px;
      font-weight: 900;
      color: var(--dark);
      line-height: 1.3;
    }

    .result-body {
      padding: 16px 16px calc(24px + env(safe-area-inset-bottom));
      flex: none;
      overflow: visible;
    }

    .simulation-embed {
      padding: 0 !important;
      overflow: visible !important;
      margin-bottom: calc(12px + env(safe-area-inset-bottom));
    }

    .simulation-embed iframe {
      width: 100%;
      height: clamp(495px, 81svh, 884px);
      border: 0;
      display: block;
    }

    @supports not (height: 100svh) {
      .simulation-embed iframe {
        height: clamp(495px, 81vh, 884px);
      }
    }

    .btn-sim-control {
      background: linear-gradient(135deg, #1E3A8A, #0F766E) !important;
      color: #fff !important;
    }

    .btn-sim-open {
      background: linear-gradient(135deg, #0F766E, #0E7490) !important;
    }

    .simulation-scroll-spacer {
      min-height: calc(120px + env(safe-area-inset-bottom));
      padding: 12px 14px calc(20px + env(safe-area-inset-bottom));
      display: flex;
      align-items: flex-end;
      justify-content: center;
      text-align: center;
      font-size: 12px;
      line-height: 1.6;
      color: #64748b;
      pointer-events: none;
    }

    .result-selected {
      background: white;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      border-left: 4px solid var(--gray);
    }

    .result-selected.great {
      border-left-color: var(--green);
    }

    .result-selected.good {
      border-left-color: var(--yellow);
    }

    .result-selected.rethink {
      border-left-color: var(--red);
    }

    .result-selected-label {
      font-size: 11px;
      color: var(--gray);
      margin-bottom: 6px;
      font-weight: 700;
    }

    .result-selected-text {
      font-size: 15px;
      color: var(--dark);
      line-height: 1.6;
    }

    .result-comment {
      background: white;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .result-comment h3 {
      font-size: 13px;
      font-weight: 700;
      color: var(--orange);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .result-comment p {
      font-size: 14px;
      line-height: 1.8;
      color: #374151;
    }

    .best-choice-box {
      background: linear-gradient(135deg, rgba(6, 214, 160, 0.1), rgba(6, 214, 160, 0.05));
      border: 2px solid var(--green);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .best-choice-box h3 {
      font-size: 13px;
      font-weight: 700;
      color: var(--green);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .best-choice-box p {
      font-size: 14px;
      line-height: 1.7;
      color: #065F46;
    }

    .learning-box {
      background: linear-gradient(135deg, rgba(17, 138, 178, 0.1), rgba(17, 138, 178, 0.05));
      border: 2px solid var(--blue);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .learning-box h3 {
      font-size: 13px;
      font-weight: 700;
      color: var(--blue);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .learning-box p {
      font-size: 14px;
      line-height: 1.7;
      color: #1E40AF;
      font-weight: 600;
    }

    .btn-continue {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, var(--dark), #2D1B4E);
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(29, 29, 44, 0.3);
    }

    /* ===== ACT BREAK SCREEN ===== */
    #screen-act-break {
      background: linear-gradient(160deg, #1D1D2C, #2D1B4E);
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .act-break-inner {
      text-align: center;
      padding: 40px 24px;
      max-width: 480px;
      margin: 0 auto;
    }

    .act-number {
      font-size: 13px;
      color: var(--orange);
      font-weight: 700;
      letter-spacing: 2px;
      margin-bottom: 12px;
    }

    .act-title {
      font-size: 28px;
      font-weight: 900;
      color: white;
      line-height: 1.3;
      margin-bottom: 16px;
    }

    .act-goal {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 14px;
      padding: 16px 20px;
      margin-bottom: 32px;
      text-align: left;
    }

    .act-goal-label {
      font-size: 11px;
      color: var(--yellow);
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .act-goal-text {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.85);
      line-height: 1.7;
    }

    .act-time-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(255, 107, 53, 0.2);
      border: 1px solid rgba(255, 107, 53, 0.4);
      color: var(--orange);
      font-size: 14px;
      font-weight: 700;
      padding: 8px 18px;
      border-radius: 20px;
      margin-bottom: 32px;
    }

    .btn-act-start {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, var(--orange), #FF8C5A);
      color: white;
      font-size: 18px;
      font-weight: 900;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(255, 107, 53, 0.4);
    }

    /* ===== HAZARD MAP SCREEN ===== */
    #screen-hazard {
      background: #F0F9FF;
      min-height: 100vh;
      flex-direction: column;
    }

    .hazard-header {
      background: linear-gradient(135deg, #0369A1, var(--blue));
      padding: 20px 16px;
      color: white;
    }

    .hazard-header h2 {
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .hazard-header p {
      font-size: 13px;
      opacity: 0.8;
      line-height: 1.5;
    }

    .hazard-body {
      padding: 16px;
      flex: 1;
    }

    .hazard-section {
      background: white;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .hazard-section h3 {
      font-size: 15px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hazard-section p {
      font-size: 13px;
      color: #6B7280;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .link-btn {
      display: block;
      width: 100%;
      padding: 14px 16px;
      background: linear-gradient(135deg, var(--blue), #0369A1);
      color: white;
      font-size: 14px;
      font-weight: 700;
      text-decoration: none;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 8px;
      transition: opacity 0.15s;
    }

    .link-btn:active {
      opacity: 0.85;
    }

    .link-btn.green {
      background: linear-gradient(135deg, var(--green), #05b386);
    }

    .link-btn.orange {
      background: linear-gradient(135deg, var(--orange), #FF8C5A);
    }

    .hazard-notice {
      background: rgba(255, 107, 53, 0.1);
      border: 1px solid rgba(255, 107, 53, 0.3);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
    }

    .hazard-notice h4 {
      font-size: 14px;
      font-weight: 700;
      color: var(--orange);
      margin-bottom: 6px;
    }

    .hazard-notice p {
      font-size: 13px;
      color: #92400E;
      line-height: 1.6;
      margin: 0;
    }

    .btn-hazard-next {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #0369A1, var(--blue));
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      margin-top: 8px;
    }

    /* ===== BCP SCREEN ===== */
    #screen-bcp {
      background: #F0FDF4;
      min-height: 100vh;
      flex-direction: column;
    }

    /* ===== COLUMN: DISASTER PRIORITY PHONE ===== */
    #screen-column-phone {
      background: #FAF5FF;
      min-height: 100vh;
      flex-direction: column;
    }

    .column-header {
      background: linear-gradient(135deg, #5B21B6, #7C3AED);
      padding: 20px 16px;
      color: white;
    }

    .column-header h2 {
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .column-header p {
      font-size: 13px;
      opacity: 0.85;
      line-height: 1.5;
    }

    .column-body {
      padding: 16px;
      flex: 1;
    }

    .column-section {
      background: white;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .column-section h3 {
      font-size: 15px;
      font-weight: 700;
      color: #1F2937;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .column-section p {
      font-size: 13px;
      color: #4B5563;
      line-height: 1.7;
      margin-bottom: 10px;
    }

    .column-section p:last-child {
      margin-bottom: 0;
    }

    .column-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 10px;
    }

    .column-table th {
      background: #EDE9FE;
      color: #5B21B6;
      font-weight: 700;
      padding: 8px 10px;
      text-align: left;
      border-bottom: 2px solid #DDD6FE;
    }

    .column-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #F3F4F6;
      color: #374151;
      line-height: 1.5;
      vertical-align: top;
    }

    .column-table tr:last-child td {
      border-bottom: none;
    }

    .column-callout {
      background: rgba(124, 58, 237, 0.08);
      border: 1px solid rgba(124, 58, 237, 0.25);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #5B21B6;
      line-height: 1.7;
    }

    .column-callout strong {
      color: #4C1D95;
    }

    .column-source {
      background: white;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .column-source h3 {
      font-size: 14px;
      font-weight: 700;
      color: #1F2937;
      margin-bottom: 10px;
    }

    .column-source ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .column-source ul li {
      font-size: 11px;
      color: #6B7280;
      padding: 5px 0;
      border-bottom: 1px solid #F3F4F6;
      line-height: 1.5;
    }

    .column-source ul li:last-child {
      border-bottom: none;
    }

    .column-source ul li a {
      color: #7C3AED;
      text-decoration: none;
    }

    .column-source ul li a:active {
      opacity: 0.7;
    }

    .btn-column-next {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #5B21B6, #7C3AED);
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      margin-top: 8px;
    }

    /* ===== COLUMN: BCP ===== */
    #screen-column-bcp {
      background: #F0FDF4;
      min-height: 100vh;
      flex-direction: column;
    }

    .column-header-green {
      background: linear-gradient(135deg, #065F46, #059669);
      padding: 20px 16px;
      color: white;
    }

    .column-header-green h2 {
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .column-header-green p {
      font-size: 13px;
      opacity: 0.85;
      line-height: 1.5;
    }

    .column-table-green th {
      background: #D1FAE5;
      color: #065F46;
      border-bottom: 2px solid #A7F3D0;
    }

    .column-callout-green {
      background: rgba(5, 150, 105, 0.08);
      border: 1px solid rgba(5, 150, 105, 0.25);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #065F46;
      line-height: 1.7;
    }

    .column-callout-green strong {
      color: #064E3B;
    }

    .column-source-green ul li a {
      color: #059669;
    }

    .btn-column-next-green {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #065F46, #059669);
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      margin-top: 8px;
    }

    .column-diagram {
      width: 100%;
      border-radius: 12px;
      margin: 8px 0 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .column-step-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #065F46, #059669);
      color: white;
      font-size: 13px;
      font-weight: 900;
      flex-shrink: 0;
      margin-right: 8px;
    }

    /* ===== COLUMN: LEGAL FRAMEWORK ===== */
    #screen-column-legal {
      background: #EFF6FF;
      min-height: 100vh;
      flex-direction: column;
    }

    .column-header-blue {
      background: linear-gradient(135deg, #1D4ED8, #2563EB);
      padding: 20px 16px;
      color: white;
    }

    .column-header-blue h2 {
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .column-header-blue p {
      font-size: 13px;
      opacity: 0.85;
      line-height: 1.5;
    }

    .column-table-blue th {
      background: #DBEAFE;
      color: #1D4ED8;
      border-bottom: 2px solid #BFDBFE;
    }

    .column-callout-blue {
      background: rgba(29, 78, 216, 0.08);
      border: 1px solid rgba(29, 78, 216, 0.25);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #1E40AF;
      line-height: 1.7;
    }

    .column-callout-blue strong {
      color: #1E3A8A;
    }

    .column-source-blue ul li a {
      color: #2563EB;
    }

    .btn-column-next-blue {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #1D4ED8, #2563EB);
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      margin-top: 8px;
    }

    /* -- emerald (vulnerable patients column) -- */
    .column-header-emerald {
      background: linear-gradient(135deg, #059669, #10B981);
      padding: 20px 16px;
      color: white;
    }

    .column-header-emerald h2 {
      font-size: 20px;
      font-weight: 800;
      margin: 0 0 8px 0;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .column-header-emerald p {
      font-size: 14px;
      line-height: 1.6;
      margin: 0;
      color: rgba(255, 255, 255, 0.95);
    }

    .column-table-emerald {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 13px;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .column-table-emerald th {
      background: #ECFDF5;
      color: #065F46;
      font-weight: 700;
      padding: 10px;
      text-align: left;
      border-bottom: 2px solid #D1FAE5;
    }

    .column-table-emerald td {
      padding: 10px;
      border-bottom: 1px solid #E5E7EB;
      color: #374151;
      vertical-align: top;
    }

    .column-callout-emerald {
      background: #F0FDF4;
      border-left: 4px solid #10B981;
      padding: 16px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
      font-size: 14px;
      line-height: 1.6;
      color: #064E3B;
    }

    .btn-column-next-emerald {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #059669, #10B981);
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      margin-top: 8px;
    }


    .column-org-chart {
      background: #F8FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
      font-size: 12px;
      line-height: 1.6;
    }

    .column-org-level {
      background: white;
      border-radius: 10px;
      padding: 10px 12px;
      margin-bottom: 8px;
      border-left: 4px solid #2563EB;
    }

    .column-org-level.prefecture {
      border-left-color: #059669;
    }

    .column-org-level.city {
      border-left-color: #F97316;
    }

    .column-org-level h4 {
      font-size: 13px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .column-org-level p {
      font-size: 12px;
      color: #6B7280;
      margin: 0;
      line-height: 1.5;
    }

    .column-org-sub {
      background: rgba(37, 99, 235, 0.06);
      border-radius: 8px;
      padding: 8px 10px;
      margin-top: 6px;
      font-size: 11px;
      color: #1E40AF;
    }

    .column-org-sub.green {
      background: rgba(5, 150, 105, 0.06);
      color: #065F46;
    }

    .column-org-sub.orange {
      background: rgba(249, 115, 22, 0.06);
      color: #9A3412;
    }

    .column-org-arrow {
      text-align: center;
      font-size: 18px;
      color: #94A3B8;
      margin: 4px 0;
    }

    /* ===== COLUMN: MENTAL HEALTH ===== */
    #screen-column-mental {
      background: #FFF1F2;
      min-height: 100vh;
      flex-direction: column;
    }

    .column-header-rose {
      background: linear-gradient(135deg, #BE185D, #E11D48);
      padding: 20px 16px;
      color: white;
    }

    .column-header-rose h2 {
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .column-header-rose p {
      font-size: 13px;
      opacity: 0.85;
      line-height: 1.5;
    }

    .column-table-rose th {
      background: #FCE7F3;
      color: #BE185D;
      border-bottom: 2px solid #FBCFE8;
    }

    .column-callout-rose {
      background: rgba(190, 24, 93, 0.06);
      border: 1px solid rgba(190, 24, 93, 0.2);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #9F1239;
      line-height: 1.7;
    }

    .column-callout-rose strong {
      color: #881337;
    }

    .column-source-rose ul li a {
      color: #E11D48;
    }

    .btn-column-next-rose {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #BE185D, #E11D48);
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      margin-top: 8px;
    }

    .column-highlight-box {
      background: rgba(190, 24, 93, 0.06);
      border-radius: 10px;
      padding: 12px 14px;
      margin: 8px 0;
      font-size: 13px;
      line-height: 1.6;
      color: #4A044E;
    }

    /* ===== COLUMN: PCAT / SUPPORT TEAMS ===== */
    #screen-column-pcat {
      background: #F0FDF4;
      min-height: 100vh;
      flex-direction: column;
    }

    .column-header-teal {
      background: linear-gradient(135deg, #0D9488, #14B8A6);
      padding: 20px 16px;
      color: white;
    }

    .column-header-teal h2 {
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .column-header-teal p {
      font-size: 13px;
      opacity: 0.85;
      line-height: 1.5;
    }

    .column-table-teal th {
      background: #CCFBF1;
      color: #0F766E;
      border-bottom: 2px solid #5EEAD4;
    }

    .column-callout-teal {
      background: rgba(13, 148, 136, 0.06);
      border: 1px solid rgba(13, 148, 136, 0.2);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 16px;
      font-size: 13px;
      color: #115E59;
      line-height: 1.7;
    }

    .column-callout-teal strong {
      color: #0F766E;
    }

    .column-source-teal ul li a {
      color: #0D9488;
    }

    .btn-column-next-teal {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #0D9488, #14B8A6);
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      margin-top: 8px;
    }

    /* ===== DISASTER APP GUIDE SCREEN ===== */
    #screen-disaster-apps {
      background: #F0F9FF;
      min-height: 100vh;
      flex-direction: column;
    }

    .app-points {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .app-points li {
      font-size: 12px;
      color: #1F2937;
      line-height: 1.7;
      margin-bottom: 2px;
    }

    .app-points li::before {
      content: "・";
      color: #2563EB;
      font-weight: 900;
      margin-right: 2px;
    }

    .bcp-header {
      background: linear-gradient(135deg, #065F46, var(--green));
      padding: 20px 16px;
      color: white;
    }

    .bcp-header h2 {
      font-size: 20px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .bcp-header p {
      font-size: 13px;
      opacity: 0.85;
      line-height: 1.5;
    }

    .bcp-body {
      padding: 16px;
      flex: 1;
    }

    .bcp-category {
      background: white;
      border-radius: 14px;
      margin-bottom: 14px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .bcp-cat-header {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .bcp-cat-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }

    .bcp-cat-info {
      flex: 1;
    }

    .bcp-cat-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--dark);
    }

    .bcp-cat-sub {
      font-size: 12px;
      color: var(--gray);
    }

    .bcp-items {
      padding: 0 16px 14px;
    }

    .bcp-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid #F3F4F6;
      cursor: pointer;
    }

    .bcp-item:last-child {
      border-bottom: none;
    }

    .bcp-checkbox {
      width: 22px;
      height: 22px;
      border: 2px solid #D1D5DB;
      border-radius: 6px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      margin-top: 1px;
    }

    .bcp-checkbox.checked {
      background: var(--green);
      border-color: var(--green);
    }

    .bcp-checkbox.checked::after {
      content: "✓";
      color: white;
      font-size: 13px;
      font-weight: 900;
    }

    .bcp-item-text {
      flex: 1;
    }

    .bcp-item-text strong {
      font-size: 14px;
      font-weight: 700;
      display: block;
      line-height: 1.4;
      color: var(--dark);
    }

    .bcp-item-text span {
      font-size: 12px;
      color: var(--gray);
      line-height: 1.5;
    }

    .bcp-score-area {
      background: white;
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 16px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .bcp-score-label {
      font-size: 13px;
      color: var(--gray);
      margin-bottom: 8px;
    }

    .bcp-score-num {
      font-size: 48px;
      font-weight: 900;
      color: var(--green);
      line-height: 1;
    }

    .bcp-score-total {
      font-size: 20px;
      color: var(--gray);
    }

    .bcp-score-msg {
      font-size: 14px;
      color: var(--dark);
      margin-top: 10px;
      line-height: 1.5;
    }

    .btn-bcp-next {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #065F46, var(--green));
      color: white;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 14px;
      cursor: pointer;
    }

    /* ===== SUMMARY SCREEN ===== */
    #screen-summary {
      background: linear-gradient(160deg, #F0F9FF, #EDE9FE, #FCE7F3);
      min-height: 100vh;
      flex-direction: column;
    }

    .summary-header {
      padding: 32px 20px 20px;
      text-align: center;
    }

    .summary-emoji {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .summary-title {
      font-size: 22px;
      font-weight: 900;
      color: #1E293B;
      margin-bottom: 8px;
    }

    .summary-sub {
      font-size: 14px;
      color: #64748B;
      line-height: 1.6;
    }

    .summary-body {
      padding: 16px;
      flex: 1;
    }

    .summary-key {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 14px;
      display: flex;
      gap: 14px;
      align-items: flex-start;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .summary-key-num {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--orange);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 900;
      color: white;
      flex-shrink: 0;
    }

    .summary-key-content {
      flex: 1;
    }

    .summary-key-title {
      font-size: 15px;
      font-weight: 700;
      color: #1E293B;
      margin-bottom: 4px;
    }

    .summary-key-text {
      font-size: 13px;
      color: #475569;
      line-height: 1.6;
    }

    .action-plan-box {
      background: rgba(255, 255, 255, 0.7);
      border: 2px solid #F59E0B;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .action-plan-box h3 {
      font-size: 15px;
      font-weight: 700;
      color: #B45309;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .action-input {
      width: 100%;
      background: #FFFBEB;
      border: 1px solid #FDE68A;
      border-radius: 10px;
      padding: 12px;
      color: #1E293B;
      font-size: 14px;
      font-family: var(--font-main);
      line-height: 1.6;
      resize: none;
      min-height: 100px;
    }

    .action-input::placeholder {
      color: #9CA3AF;
    }

    .action-input:focus {
      outline: none;
      border-color: #F59E0B;
    }

    .action-hint {
      font-size: 11px;
      color: #9CA3AF;
      margin-top: 6px;
      text-align: right;
    }

    .btn-save-summary {
      width: 100%;
      margin-top: 10px;
      padding: 12px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #14B8A6, #0EA5E9);
      color: white;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
    }

    .btn-save-summary:disabled {
      opacity: 0.6;
      cursor: wait;
    }

    .summary-footer {
      padding: 0 16px 32px;
      padding-bottom: max(32px, env(safe-area-inset-bottom));
      text-align: center;
    }

    .summary-footer p {
      font-size: 13px;
      color: #94A3B8;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .btn-restart {
      width: 100%;
      padding: 16px;
      background: rgba(255, 255, 255, 0.6);
      color: #475569;
      font-size: 15px;
      font-weight: 700;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 14px;
      cursor: pointer;
    }

    /* ===== INTRO BANNER (acts 2/3) ===== */
    .facilitator-banner {
      background: rgba(255, 107, 53, 0.12);
      border: 1px solid rgba(255, 107, 53, 0.3);
      border-radius: 12px;
      padding: 12px 14px;
      margin: 0 12px 12px;
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .facilitator-banner .icon {
      font-size: 18px;
      flex-shrink: 0;
    }

    .facilitator-banner p {
      font-size: 12px;
      color: var(--dark);
      line-height: 1.6;
    }

    .facilitator-banner p strong {
      color: var(--orange);
    }

    /* ===== ANIMATIONS ===== */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: fadeInUp 0.35s ease forwards;
    }

    /* ===== UTILITIES ===== */
    .text-center {
      text-align: center;
    }

    .mb-8 {
      margin-bottom: 8px;
    }

    .mt-16 {
      margin-top: 16px;
    }

    /* Added fixes for text visibility */
    .learning-box,
    .result-comment,
    .result-best,
    .best-choice-box {
      background: rgba(255, 255, 255, 0.95) !important;
      color: #1e293b !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .learning-box h3,
    .result-comment h3,
    .result-best h3 {
      color: #d97706 !important;
    }

    #break-facilitator-note,
    .facil-note {
      background: rgba(255, 255, 255, 0.95) !important;
      color: #1e293b !important;
      text-shadow: none !important;
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>

  <!-- ===== PROGRESS BAR ===== -->
  <div id="progress-bar-wrap">
    <div id="progress-bar" style="width: 0%"></div>
  </div>
  <div class="act-label" id="act-label"></div>
  <button id="menu-toggle-btn" class="menu-toggle-btn" type="button" aria-label="シーンジャンプメニュー" aria-expanded="false"
    onclick="toggleJumpMenu()">
    ☰
  </button>
  <div id="jump-menu-overlay" class="jump-menu-overlay" onclick="closeJumpMenu()"></div>
  <aside id="jump-menu" class="jump-menu" aria-label="シーンジャンプメニュー">
    <div class="jump-menu-header">
      <div class="jump-menu-title">シーンジャンプ</div>
      <button class="jump-menu-close" type="button" aria-label="メニューを閉じる" onclick="closeJumpMenu()">×</button>
    </div>
    <div class="jump-menu-body">
      <div class="jump-group">
        <div class="jump-group-title">おすすめ</div>
        <button class="jump-item jump-item-primary" type="button" onclick="jumpToOpeningDoor()">🚪
          冒頭の扉へ（第1幕開始前）</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">章の扉</div>
        <button class="jump-item jump-item-door" type="button" onclick="jumpToActDoor('act1')">🚪 第1幕の扉</button>
        <button class="jump-item jump-item-door" type="button" onclick="jumpToActDoor('act2')">🚪 第2幕の扉</button>
        <button class="jump-item jump-item-door" type="button" onclick="jumpToActDoor('act3')">🚪 第3幕の扉</button>
        <button class="jump-item jump-item-door" type="button" onclick="jumpToActDoor('act4')">🚪 第4幕の扉</button>
        <button class="jump-item jump-item-door" type="button" onclick="jumpToActDoor('act5')">🚪 第5幕の扉</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">全体</div>
        <button class="jump-item" type="button" onclick="jumpToScreen('title')">タイトル</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('news')">ニュース</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('summary')">まとめ</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">第1幕</div>
        <button class="jump-item" type="button" onclick="jumpToScene('1-1')">シーン1（発災！まず何から？）</button>
        <button class="jump-item" type="button" onclick="jumpToScene('1-2')">シーン2（家族への連絡）</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">第2幕</div>
        <button class="jump-item" type="button" onclick="jumpToScene('2-1')">シーン3（連絡ツリー）</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('column-phone')">📞 コラム：災害時優先電話</button>
        <button class="jump-item" type="button" onclick="jumpToScene('2-info')">シーン情報収集（防災アプリ）</button>
        <button class="jump-item" type="button" onclick="openDisasterAppsGuide('2-2')">防災アプリ紹介ページ</button>
        <button class="jump-item" type="button" onclick="jumpToScene('2-2')">シーン4（災害対策本部と調整本部）</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('column-legal')">⚖️ コラム：災害対応の法的枠組み</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">第3幕</div>
        <button class="jump-item" type="button" onclick="jumpToScene('3-1')">シーン5（BCPの備え）</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('column-bcp')">📋 コラム：BCPとは</button>
        <button class="jump-item" type="button" onclick="jumpToScene('3-2')">シーン6（要配慮者の避難）</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('column-vulnerable')">💊 コラム：要配慮者と「もしものとき」</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">第4幕</div>
        <button class="jump-item" type="button" onclick="jumpToScene('4-1')">シーン7（スタッフへの声かけ）</button>
        <button class="jump-item" type="button" onclick="jumpToScene('4-2')">シーン8（PFA対応）</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('column-mental')">🧠 コラム：こころのケア</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">第5幕</div>
        <button class="jump-item" type="button" onclick="jumpToScene('5-1')">シーン9（受援力）</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('column-pcat')">🤝 コラム：災害支援チームとPCAT</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">その他</div>
        <button class="jump-item" type="button" onclick="jumpToScreen('hazard')">ハザードマップ</button>
        <button class="jump-item" type="button" onclick="jumpToScreen('bcp')">BCPチェックリスト</button>
      </div>
      <div class="jump-group">
        <div class="jump-group-title">システム</div>
        <button class="jump-item" type="button" onclick="reloadPage()">ページ更新</button>
        <button class="jump-item" type="button" onclick="shareApp()">📤 このアプリをシェアする</button>
      </div>
    </div>
  </aside>

  <!-- ===========================
     SCREEN 1: TITLE
=========================== -->
  <div id="screen-title" class="screen active">
    <div class="title-inner">
      <!-- 画像挿入ポイント：タイトル画面のトップ画像 -->
      <img src="doctor_cat.png" alt="Doctor Cat"
        style="width: 160px; height: 160px; border-radius: 50%; border: 4px solid white; margin-bottom: 20px; box-shadow: 0 10px 25px rgba(255,107,53,0.4); object-fit: cover; background: white; object-position: center top;">

      <div class="title-main">地震TRPGシナリオ<br>マタタビクリニック<br>院長の一日</div>
      <div class="title-sub">あなたが地域医療を守るために<br>今日できることを考えよう</div>

      <div class="char-card">
        <div class="char-card-title">🎭 あなたのキャラクター</div>
        <div class="char-name">🐾 ネコミヤ ニャンタ</div>
        <div class="char-name-sub">猫山県またたび市　マタタビクリニック 院長</div>
        <div class="char-desc">
          2025年4月に開業した無床診療所医師（医師1名、事務2名、看護師2名）。
          月水金は午前訪問診療、それ以外は終日外来をこなす家庭医。
          今日は訪問診療の帰り道。午前10時45分。
        </div>
      </div>

      <div class="time-badge">
        <div class="icon">🚨</div>
        <div class="text">
          <strong>緊急速報</strong><br>
          2026年2月23日（月）10:45<br>
          ねこやま県またたび市で震度6強
        </div>
      </div>

      <button class="btn-start" onclick="showScreen('news')">
        シナリオを開始する →
      </button>

      <div
        style="margin: 12px auto 0; max-width: 300px; color: rgba(255,255,255,0.45); font-size: 11px; line-height: 1.7; text-align: center; padding: 0 4px;">
        このアプリは「災害への備えを平時の診療の質向上につなげる」ことを目的として、若手医師のための家庭医療学 冬期セミナー2026の際に開発されました。その後の振り返りも含めて、当面の間は自由にお使いいただけます。
      </div>
    </div>
  </div>

  <!-- ===========================
     SCREEN 2: NEWS
=========================== -->
  <div id="screen-news" class="screen">
    <div class="news-inner">

      <!-- 画像挿入ポイント：ニュース画面（街の被害など） -->
      <!-- <div class="image-placeholder" style="width: 100%; height: 160px; background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.6); font-size: 12px;">ニュース映像・街の被害の画像</div> -->

      <div class="tv-frame">
        <div class="tv-header">
          <div class="tv-channel">📺 ニャンタビ放送 NTB</div>
          <div class="tv-live">● LIVE</div>
        </div>
        <div class="tv-screen">
          <div class="tv-breaking">⚡ 緊急速報</div>
          <div class="tv-headline">ねこやま県またたび市<br>震度6強の地震発生</div>
          <div class="tv-body">
            本日10時45分ごろ、ねこやま県またたび市を震源とする
            震度6強の地震が発生しました。
            市内各所で建物倒壊等の甚大な被害が確認され、
            またたび中央病院を含む主要医療機関が被災し受け入れ困難な状況です。
            現在、市役所および保健所に災害対策本部・保健医療福祉調整本部が立ち上がり情報収集を急いでいます。
          </div>
        </div>
        <div class="tv-ticker">
          <div class="tv-ticker-inner">
            【速報】またたび市で震度6強 ／ 中央病院含む主要医療機関が被災 ／ 道路寸断・通信障害発生中 ／ 市役所・保健所に調整本部が立ち上げ ／
          </div>
        </div>
      </div>

      <div class="news-detail">
        <h3>🚗 あなたの状況</h3>
        <ul>
          <li>午前中の訪問診療を終え、クリニックへの帰り道</li>
          <li>突然の強い揺れ。直ちに車を路肩に停車</li>
          <li>前方の道路が大きく陥没しているのを目撃</li>
        </ul>
      </div>

      <button class="btn-news-next" onclick="startAct1()">
        第1幕へ進む →
      </button>
    </div>
  </div>

  <!-- ===========================
     SCREEN 3: CHAT (LINE-style)
=========================== -->
  <div id="screen-chat" class="screen">
    <div class="chat-header">
      <div class="chat-avatar">🐾</div>
      <div class="chat-header-info">
        <div class="chat-header-name">マタタビクリニック院長の一日</div>
        <div class="chat-header-sub" id="chat-header-sub">第1幕：発災直後の初動</div>
      </div>
    </div>

    <div class="chat-body" id="chat-body">
      <!-- Messages injected by JS -->
    </div>

    <div class="choice-area" id="choice-area" style="display:none">
      <div class="choice-label" id="choice-label">どうしますか？</div>
      <div id="choice-buttons"></div>
    </div>
  </div>

  <!-- ===========================
     SCREEN 4: RESULT
=========================== -->
  <div id="screen-result" class="screen">
    <div class="result-header">
      <div class="result-badge" id="result-badge"></div>
      <div class="result-title" id="result-title"></div>
    </div>
    <div class="result-body" id="result-body"></div>
  </div>

  <!-- ===========================
     SCREEN 5: ACT BREAK
=========================== -->
  <div id="screen-act-break" class="screen">
    <div class="act-break-inner">
      <div class="act-number" id="break-act-number"></div>
      <div class="act-title" id="break-act-title"></div>
      <div class="act-goal">
        <div class="act-goal-label">このActのねらい</div>
        <div class="act-goal-text" id="break-act-goal"></div>
      </div>
      <div class="act-time-badge">
        <span>⏱</span>
        <span id="break-act-time"></span>
      </div>
      <div
        style="margin-bottom:16px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.1); border-radius:14px; padding:14px 16px; text-align:left;">
        <div style="font-size:11px; color:#FFD166; font-weight:700; margin-bottom:6px;">🎙 ファシリテーターから</div>
        <div style="font-size:13px; color:rgba(255,255,255,0.8); line-height:1.7;" id="break-facilitator-note"></div>
      </div>
      <button class="btn-act-start" id="btn-act-start">開始する →</button>
    </div>
  </div>

  <!-- ===========================
     SCREEN 6: HAZARD MAP
=========================== -->
  <div id="screen-hazard" class="screen">
    <div class="hazard-header">
      <h2>🗺 ハザードマップ確認</h2>
      <p>またたび市での体験をもとに、あなたの地域のハザードマップも確認してみてください。</p>
    </div>
    <div class="hazard-body">
      <div class="hazard-notice">
        <h4>📍 またたび市シナリオから学んだこと</h4>
        <p>
          震度6強では道路寸断・建物被害・通信障害が同時に発生します。
          平時に「どこに何があるか」を知っておくことが、災害時の行動を大きく変えます。
        </p>
      </div>

      <div class="hazard-section">
        <h3>🌐 全国ハザードマップ</h3>
        <p>
          国土地理院の「重ねるハザードマップ」で洪水・土砂・地震・津波など
          複数のリスクを重ねて確認できます。
        </p>
        <a href="https://disaportal.gsi.go.jp/" target="_blank" class="link-btn">
          🗾 重ねるハザードマップ（国土地理院）
        </a>
      </div>


      <div
        style="background:white; border-radius:14px; padding:16px; margin-bottom:16px; box-shadow:0 2px 8px rgba(0,0,0,0.06);">
        <h3 style="font-size:15px; font-weight:700; color:var(--dark); margin-bottom:12px;">✍️ 個人ワーク</h3>
        <p style="font-size:14px; color:#374151; line-height:1.8; margin-bottom:12px;">
          上のリンクを開いて、以下を確認してみてください。
        </p>
        <div style="background:var(--light-gray); border-radius:10px; padding:14px;">
          <div style="font-size:13px; color:var(--dark); line-height:2;">
            ☐ あなたのクリニック（または職場）のハザードリスク<br>
            ☐ 自宅のハザードリスク<br>
            ☐ 担当している要配慮者の居住エリア<br>
            ☐ 近隣の避難所・避難場所の位置
          </div>
        </div>
      </div>

      <button class="btn-hazard-next" onclick="showBCP()">
        BCPチェックリストへ →
      </button>
    </div>
  </div>

  <!-- ===========================
     SCREEN 7: DISASTER APP GUIDE
=========================== -->
  <div id="screen-disaster-apps" class="screen">
    <div class="hazard-header">
      <h2>📱 防災アプリ紹介</h2>
      <p>次のシーンに進む前に、災害時に役立つアプリを確認してみます。</p>
    </div>
    <div class="hazard-body">
      <div class="hazard-notice">
        災害時は電話・通常サイトがつながりにくくなります。<br>
        平時から「速報性」と「公式性」の高いアプリを準備しておくと、初動判断が速くなります。
      </div>

      <div class="hazard-section">
        <h3>📡 NHKニュース・防災</h3>
        <p>地震・津波・気象警報などを速報で確認しやすいアプリです。</p>
        <ul class="app-points">
          <li>地域設定で登録地域の防災情報を受け取れる</li>
          <li>災害関連ニュースをまとめて確認しやすい</li>
          <li>地図とあわせて現在の状況を把握しやすい</li>
          <li>公式メディア情報として判断材料に使える</li>
        </ul>
        <a href="https://www.nhk.or.jp/nhkone/service/app/news_bousai/" target="_blank" rel="noopener noreferrer"
          class="link-btn">
          🔗 NHKニュース・防災（公式）を開く
        </a>
      </div>

      <div class="hazard-section">
        <h3>📡 Yahoo!防災速報</h3>
        <p>地震・大雨・避難情報など、多ハザードの通知に対応しています。</p>
        <ul class="app-points">
          <li>現在地や登録地域ごとに通知を受け取れる</li>
          <li>避難情報や警報をタイムリーに確認できる</li>
          <li>家族の地域を登録して見守りにも使える</li>
        </ul>
        <a href="https://emg.yahoo.co.jp/" target="_blank" rel="noopener noreferrer" class="link-btn orange">
          🔗 Yahoo!防災速報（公式）を開く
        </a>
      </div>

      <div class="hazard-section">
        <h3>🗺️ 避難所マップ hinanjyo.jp</h3>
        <p>全国の避難所・開設状況をリアルタイムで確認できるサービスです。</p>
        <ul class="app-points">
          <li>近くの避難所の開設・閉鎖状況が地図で確認できる</li>
          <li>収容人数・混雑状況もわかる</li>
          <li>患者さんの避難先確認や安否確認に役立つ</li>
        </ul>
        <a href="https://www.hinanjyo.jp/" target="_blank" rel="noopener noreferrer" class="link-btn">
          🔗 避難所マップ hinanjyo.jp を開く
        </a>
      </div>

      <div class="hazard-notice">
        使い分けの目安<br>
        どちらか一方だけでも十分に有効です。まずは使い慣れた1つを通知ONで運用してみてください。
      </div>

      <button class="btn-hazard-next" onclick="continueFromDisasterAppsGuide()">次のシーンへ進む →</button>
    </div>
  </div>

  <!-- ===========================
     SCREEN: COLUMN – MENTAL HEALTH
=========================== -->
  <div id="screen-column-mental" class="screen">
    <div class="column-header-rose">
      <h2>🧠 コラム：災害時のこころのケア</h2>
      <p>ストレス反応は正常な身体の防御反応です。PFA（Psychological First Aid）とセルフケアの基本を見ていきます。</p>
    </div>
    <div class="column-body">

      <!-- 1. ストレス反応 -->
      <div class="column-section">
        <h3>⚡ ストレス反応は「正常な反応」</h3>
        <p>災害のような圧倒的なストレスに直面すると、人の身体は自動的に反応します。これは<strong>生存のための自然な反応</strong>です。</p>
        <table class="column-table column-table-rose">
          <thead>
            <tr>
              <th>反応</th>
              <th>状態</th>
              <th>サイン</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>戦う (Fight)</strong></td>
              <td>少しの刺激にも過剰に反応します</td>
              <td>衝動的になる・怒りっぽくなる</td>
            </tr>
            <tr>
              <td><strong>逃げる (Flight)</strong></td>
              <td>常に警戒し、逃げられる準備をしています</td>
              <td>落ち着きがなくなる・過敏になる</td>
            </tr>
            <tr>
              <td><strong>固まる (Freeze)</strong></td>
              <td>刺激をシャットアウトしています</td>
              <td>妙におとなしくなる・孤立する</td>
            </tr>
          </tbody>
        </table>
        <div class="column-highlight-box">
          💡 怒りっぽくなる、眠れない、ぼんやりする。これらはすべて<strong>異常な事態に対する正常な反応</strong>です。多くの場合、時間とともに自然回復します。
        </div>
      </div>

      <!-- 2. MHPSS -->
      <div class="column-section">
        <h3>🔺 MHPSS介入ピラミッド</h3>
        <p>日本で使われる「こころのケア」は、<strong>MHPSS（Mental Health and Psychosocial
            Support：精神保健および心理社会支援）</strong>と整理すると理解しやすいです。<br>
          PTSDなどの「病理的な側面」だけでなく「公衆衛生的なアプローチ」にも注目し、社会的サポートや生活支援などの「心理社会的な支援」を含みます。</p>
        <img src="MHPSS.png" alt="MHPSS介入ピラミッド：プライマリ・ケア提供者の役割" class="column-diagram">
        <p>このピラミッドはすべての層が重要で、同時に実施することが理想的です。下2層（基本的サービス・コミュニティ支援）が損なわれると、PTSD発症のリスクが高まることがわかっています（Brewin, et al.,
          2000）。<br>
          プライマリ・ケア提供者が主に関わるのは<strong>第2層（コミュニティ支援）～第3層（非専門家による個別支援：PFAなど）</strong>です。</p>
      </div>

      <!-- 3. PFA -->
      <div class="column-section">
        <h3>🩺 PFA（心理的応急処置）</h3>
        <p>PFAはカウンセリングではなく、<strong>実用的な支援・Do No Harmの原則</strong>に基づいた初期対応です。</p>
        <img src="1P3L.png" alt="PFAの行動原則：Preparation, Look, Listen, Link" class="column-diagram">
        <table class="column-table column-table-rose">
          <thead>
            <tr>
              <th>PFAは...</th>
              <th>ではない</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>実用的な支援です</td>
              <td>カウンセリングではありません</td>
            </tr>
            <tr>
              <td>誰でもできる初期対応です</td>
              <td>傾聴だけではありません</td>
            </tr>
            <tr>
              <td>つなぐための行動です</td>
              <td>精神療法ではありません</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 4. 傾聴の5要素 -->
      <div class="column-section">
        <h3>👂 傾聴の5要素</h3>
        <table class="column-table column-table-rose">
          <thead>
            <tr>
              <th>#</th>
              <th>要素</th>
              <th>ポイント</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><strong>集中</strong></td>
              <td>「聞いていますよ」という姿勢を示します</td>
            </tr>
            <tr>
              <td>2</td>
              <td><strong>繰り返し</strong></td>
              <td>キーワードを復唱します「～なのですね」</td>
            </tr>
            <tr>
              <td>3</td>
              <td><strong>共感</strong></td>
              <td>正常化「このような状況であれば起こるストレス反応で、正常な反応です。」<br>一般化「他の人もあなたと同じような状況であれば、同様なストレス反応が出ると思います。お辛い経験をされましたね。」</td>
            </tr>
            <tr>
              <td>4</td>
              <td><strong>質問</strong></td>
              <td>ニーズを明確にするための問いかけをします</td>
            </tr>
            <tr>
              <td>5</td>
              <td><strong>要約</strong></td>
              <td>「つまり～ということですね」と確認します</td>
            </tr>
          </tbody>
        </table>
        <p>
          特に<strong>正常化と一般化</strong>が助けになります。「このような状況であれば起こる正常な反応ですよ（正常化）」「同じ状況であれば他の人も同様に反応すると思います（一般化）」と伝えるだけで、相手の孤立感が和らぎ安心感につながります。
        </p>
      </div>

      <!-- 5. 3R -->
      <div class="column-section">
        <h3>🌀 ストレス対処法の3R</h3>
        <table class="column-table column-table-rose">
          <thead>
            <tr>
              <th>R</th>
              <th>意味</th>
              <th>災害下での実践例</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Rest</strong></td>
              <td>休息・睡眠をとります</td>
              <td>こまめに休憩し、十分な睡眠を確保します</td>
            </tr>
            <tr>
              <td><strong>Recreation</strong></td>
              <td>気晴らしをします</td>
              <td>簡単な体操をしたり、チーム内で談笑したりします</td>
            </tr>
            <tr>
              <td><strong>Relax</strong></td>
              <td>リラクゼーションを行います</td>
              <td>呼吸法やストレッチ、お茶を飲むなどです</td>
            </tr>
          </tbody>
        </table>
        <p>＋ <strong>身近な相手との交流・相談</strong></p>
      </div>

      <!-- 6. リラクセーション -->
      <div class="column-section">
        <h3>☕ リラックスの本質</h3>
        <p>リラックスとは「無」になることではありません。<strong>「記憶を使わない時間を確保する」</strong>ことです。</p>
        <div class="column-highlight-box">
          💻 災害後の頭の中 = <strong>ブラウザのタブを大量に開いた状態</strong><br>
          過去の記憶・未来の心配・やるべきことがメモリを消費し続けています。<br><br>
          リラクゼーション = <strong>タブを一時的に閉じる</strong>作業<br>
          呼吸の感覚、お茶の温度、筋肉の緩みといった<strong>五感を意識する</strong>ことで、記憶を使わない時間が生まれ、脳が回復します。
        </div>
        <p>お茶をゆっくり飲むことも立派なリラクゼーション法です。味・匂い・温度に集中している間は、過去の記憶も未来の心配も使っていません。</p>
      </div>

      <!-- 7. 精神科紹介 -->
      <div class="column-section">
        <h3>🏥 専門家への紹介を考慮するサイン</h3>
        <p>PFAで対応できる範囲を超えるケース：</p>
        <table class="column-table column-table-rose">
          <tbody>
            <tr>
              <td>状況が落ち着いた後も<strong>強いストレスが続く</strong></td>
            </tr>
            <tr>
              <td>人格や行動に大きな変化があり<strong>継続している</strong></td>
            </tr>
            <tr>
              <td><strong>日常生活に支障</strong>をきたしている</td>
            </tr>
            <tr>
              <td>自分自身や他者を<strong>傷つけるリスク</strong>がある</td>
            </tr>
          </tbody>
        </table>
        <p>→ MHPSSピラミッドの<strong>第4層（専門家によるサービス）</strong>への橋渡しを検討します。</p>
      </div>

      <!-- 8. シナリオ接続 -->
      <div class="column-callout-rose">
        <strong>🐱 マタタビクリニックの場合</strong><br>
        シーン7・8で、めっけさんの疑れない様子に気づき（<strong>Look</strong>）、声をかけて話を聞き（<strong>Listen</strong>）、必要な支援につなげました（<strong>Link</strong>）。<br>
        そして、ネコミヤ先生自身のセルフケアも忘れずに（<strong>Preparation</strong>）。「睡眠・食事・笑うこと」が心の健康のバロメーターです。
      </div>

      <!-- 9. 出典 -->
      <div class="column-source column-source-rose">
        <h3>📚 参考資料</h3>
        <ul>
          <li><a href="https://www.who.int/publications-detail-redirect/9789241548205" target="_blank"
              rel="noopener noreferrer">WHO PFA Guide for Field Workers (2011)</a></li>
          <li><a href="https://kokoro.mhlw.go.jp/usagi/ug004/" target="_blank"
              rel="noopener noreferrer">厚生労働省「こころの耳」3つのR</a></li>
          <li>Brewin, C. R., Andrews, B., & Valentine, J. D. (2000). Meta-analysis of risk factors for posttraumatic
            stress disorder in trauma-exposed adults. Journal of consulting and clinical psychology, 68(5), 748.</li>
          <li><a href="https://plaza.umin.ac.jp/kokoronokamae/archives/intervention-pyramid/" target="_blank"
              rel="noopener noreferrer">こころのかまえ研究会「こころのケア のピラミッド」</a></li>
        </ul>
      </div>

      <div style="font-size:11px; color:#9CA3AF; text-align:center; margin-bottom:12px;">※ 本資料はワークショップ補足教材です。</div>

      <button class="btn-column-next-rose" onclick="continueFromColumnMental()">グループ内で振り返ったら 第5幕へ →</button>
    </div>
  </div>

  <!-- ===========================
     SCREEN: COLUMN – PCAT / SUPPORT TEAMS
=========================== -->
  <div id="screen-column-pcat" class="screen">
    <div class="column-header-teal">
      <h2>🤝 コラム：災害支援チームとPCAT</h2>
      <p>災害時にどんな支援チームが・いつ・どこで活動するのか。PCATの役割と活動原則について紹介します。</p>
    </div>
    <div class="column-body">



      <!-- 2. 現行の支援体制 -->
      <div class="column-section">
        <h3>🔄 DMATからの引き継ぎ</h3>
        <p>発災直後はDMATが一元的に対応しますが、時間の経過とともに支援先に応じて各チームへ引き継がれていきます。</p>
        <img src="現行の活動イメージ.png" alt="現行の活動イメージ：DMATから各チームへの引き継ぎ" class="column-diagram">
        <table class="column-table column-table-teal">
          <thead>
            <tr>
              <th>支援先</th>
              <th>主なチーム</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>病院</td>
              <td>各専門・職種団体、災害支援ナースなどが支援します</td>
            </tr>
            <tr>
              <td>施設</td>
              <td>全社協、老施協派遣介護士等が支援します</td>
            </tr>
            <tr>
              <td>プライマリ・ケア</td>
              <td>日赤、JMATが支援します</td>
            </tr>
            <tr>
              <td>避難所・保健活動</td>
              <td>保健師が対応します</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 3. PCATの2つの柱 -->
      <div class="column-section">
        <h3>🎯 PCATは何をするチームなのか</h3>
        <p>PCATの活動には<strong>2つの柱</strong>があります。</p>

        <p style="margin-top:12px;"><strong>① 小規模医療・福祉関連機関への支援</strong></p>
        <img src="支援イメージ.png" alt="PCATの支援イメージ：JPCA会員医療機関から災害の影響を受けた地域の小規模機関へ" class="column-diagram"
          style="margin-bottom:8px;">
        <p>
          災害時、災害拠点病院や避難所には多くの支援チームが入りますが、地域の診療所や小規模福祉施設への支援は手薄になりがちです。PCATは<strong>クリニック・訪問看護ステーション・老人福祉施設等</strong>を支援対象としています。
        </p>

        <p style="margin-top:12px;"><strong>② 保健医療福祉調整本部でのリエゾン活動</strong></p>
        <p>災害の影響を受けた地域での支援活動の際に他機関との調整・協働のためにリエゾン活動も想定しています。</p>
      </div>

      <!-- 4. 3つの方針と活動原則 -->
      <div class="column-section">
        <h3>🛡️ PCATの3つの方針</h3>
        <p>PCATは発足当初から以下の<strong>3つの方針</strong>を掲げています。</p>
        <table class="column-table column-table-teal">
          <thead>
            <tr>
              <th>#</th>
              <th>方針</th>
              <th>内容</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><strong>継続性を重視した底上げ型支援</strong></td>
              <td>急性期の救命だけでなく、亜急性期から中長期まで地域医療・福祉の継続を支えます</td>
            </tr>
            <tr>
              <td>2</td>
              <td><strong>多職種による包括的支援</strong></td>
              <td>医師・看護師・薬剤師・事務職など多職種連携のもとにプライマリ・ケアを提供します</td>
            </tr>
            <tr>
              <td>3</td>
              <td><strong>将来の災害に向けた学術的支援</strong></td>
              <td>活動の記録・検証を行い、次の災害への備えに活かします</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 4b. スフィア基準と「傷つけない支援」 -->
      <div class="column-section">
        <h3>📏 活動原則と傷つけない支援（Do No Harm）</h3>
        <p>PCATの活動原則は<strong>「Do No
            Harm（傷つけない支援）」</strong>です。外部から来た支援チームが現場を主導するのではなく、<strong>受援側（災害の影響を受けた地域の医療者）が意思決定の中心にいる</strong>ことを意味しています。
        </p>
        <p>この原則を実践するため、国際的な人道支援の標準である<strong>スフィア基準</strong>を評価軸として取り入れ、災害の影響を受けた人びとの尊厳と権利を守る支援を行っています。</p>
        <table class="column-table column-table-teal">
          <thead>
            <tr>
              <th>取り組み</th>
              <th>内容</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>派遣前研修</strong></td>
              <td>スフィア基準を用いたケースワークを実施します</td>
            </tr>
            <tr>
              <td><strong>活動中</strong></td>
              <td>受益者からの定期的フィードバックの仕組みを構築しています</td>
            </tr>
            <tr>
              <td><strong>活動後</strong></td>
              <td>必須基準に基づいた相互評価を実施します</td>
            </tr>
          </tbody>
        </table>
      </div>


      <!-- 4d. まとめ -->
      <div class="column-section">
        <h3>📋 PCATの活動まとめ</h3>

        <table class="column-table column-table-teal">
          <tbody>
            <tr>
              <td><strong>支援対象</strong></td>
              <td>小規模医療・福祉関連機関（診療所、訪問看護ステーション、老人福祉施設等）</td>
            </tr>
            <tr>
              <td><strong>活動時期</strong></td>
              <td>亜急性期〜中長期</td>
            </tr>
            <tr>
              <td><strong>活動原則</strong></td>
              <td>Do No Harm（スフィア基準に基づく傷つけない支援）</td>
            </tr>
            <tr>
              <td><strong>活動内容</strong></td>
              <td>診療代行、事務機能回復支援、調整本部リエゾン等</td>
            </tr>
            <tr>
              <td><strong>目標</strong></td>
              <td>災害の影響を受けた人びとの生活全体を包括的に支える</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 5. シナリオ接続 -->
      <div class="column-callout-teal">
        <strong>🐱 マタタビクリニックの場合</strong><br>
        発災から1ヶ月。急性期のチームが撤収し始める中で、PCATから「メディカルスタッフを派遣できる可能性がある」と連絡がありました。<br><br>
        PCATは診療の代行だけでなく、調整本部との橋渡しや事務機能の回復支援も行います。支援を受けるとき大切なのは、<strong>今の状況・困っていること・やりたいことを率直に伝える</strong>こと。PCATは受援側の意思決定を尊重します。
      </div>

      <!-- 6. 事例紹介 -->
      <div class="column-source column-source-teal">
        <h3>📘 参考・事例紹介</h3>
        <p style="font-size:13px; line-height:1.7; margin-bottom:14px;">
          本学会では2011年の東日本大震災を契機に、これまで複数の大規模災害において支援活動を展開してきました。
        </p>

        <p style="font-size:13px; font-weight:bold; margin-bottom:4px;">📌 東日本大震災（2011年）</p>
        <p style="font-size:13px; line-height:1.7; margin-bottom:8px;">
          延べ678名の学会員らを動員し、気仙沼・石巻で4年半にわたる活動を展開しました。詳細は日本プライマリ・ケア連合学会誌 第38巻 特別号にてご覧いただけます。
        </p>
        <a href="https://www.jstage.jst.go.jp/browse/generalist/38/Supplement/_contents/-char/ja" target="_blank"
          rel="noopener noreferrer"
          style="display:block; background:rgba(45,212,191,0.15); border:1px solid var(--secondary); color:var(--secondary); padding:8px 12px; border-radius:6px; text-decoration:none; font-size:12px; margin-bottom:14px;">
          🔗 日本プライマリ・ケア連合学会誌 第38巻 特別号（J-STAGE）
        </a>

        <p style="font-size:13px; font-weight:bold; margin-bottom:4px;">📌 熊本地震（2016年）</p>
        <p style="font-size:13px; line-height:1.7; margin-bottom:14px;">
          熊本県益城町からの派遣要請を受け、「PCAT2016」として災害支援チームを立ち上げました。延べ38名が4月から8月までの約4か月間にわたって活動。益城町の避難所対策チームに加わり、避難所での保健医療に関する助言や調整役を担いました。
        </p>

        <p style="font-size:13px; font-weight:bold; margin-bottom:4px;">📌 令和6年能登半島地震・奥能登豪雨災害（2024年）</p>
        <p style="font-size:13px; line-height:1.7; margin-bottom:8px;">
          「地域医療資源を傷つけない支援」をミッションとして掲げ、支援活動を展開しました。
        </p>
        <a href="https://www.primarycare-japan.com/news-detail.php?nid=1197" target="_blank" rel="noopener noreferrer"
          style="display:block; background:rgba(45,212,191,0.15); border:1px solid var(--secondary); color:var(--secondary); padding:8px 12px; border-radius:6px; text-decoration:none; font-size:12px; margin-bottom:4px;">
          🔗 令和6年能登半島地震・奥能登豪雨災害における活動報告（JPCA）
        </a>
      </div>

      <!-- 7. 出典 -->
      <div class="column-source column-source-teal">
        <h3>📚 参考資料</h3>
        <ul>
          <li>日本プライマリ・ケア連合学会 PCAT導入研修資料</li>
          <li><a href="https://www.primarycare-japan.com/theme-detail.php?thid=58" target="_blank"
              rel="noopener noreferrer">JPCA災害医療システム委員会</a></li>
          <li><a href="https://jqan.info/wpJQ/wp-content/uploads/2019/10/spherehandbook2018_jpn_web.pdf" target="_blank"
              rel="noopener noreferrer">スフィアハンドブック（2018年版 日本語訳）</a></li>
          <li>日本プライマリ・ケア連合学会. 令和6年能登半島地震 災害支援プロジェクト活動報告書. 2025.</li>
          <li>日本プライマリ・ケア連合学会. 令和6年9月奥能登豪雨 災害支援プロジェクト活動報告書. 2025.</li>
        </ul>
      </div>

      <div style="font-size:11px; color:#9CA3AF; text-align:center; margin-bottom:12px;">※ 本資料はワークショップ補足教材です。</div>

      <button class="btn-column-next-teal" onclick="continueFromColumnPcat()">まとめページへ進む →</button>
    </div>
  </div>

  <!-- ===========================
     SCREEN: COLUMN - LEGAL FRAMEWORK
=========================== -->
  <div id="screen-column-legal" class="screen">
    <div class="column-header-blue">
      <h2>⚖️ コラム：災害対応の法的枠組み</h2>
      <p>激甚災害、保健医療福祉調整本部ってどんな仕組み？ 日本の災害対応の法制度を整理します。</p>
    </div>
    <div class="column-body">

      <!-- 0. 導入：まず全体像をつかもう -->
      <div class="column-section">
        <h3>🗺️ まず全体像をつかもう</h3>
        <p>日本の災害対応には、大きく<strong>3つの法律</strong>が関わっています。それぞれ<strong>役割が違い</strong>、<strong>動くタイミングも違います</strong>。</p>
        <div class="column-org-chart" style="margin: 12px 0;">
          <div class="column-org-level" style="background:#EFF6FF; border-left:4px solid #3B82F6; padding:10px 14px;">
            <div style="font-size:15px; font-weight:bold;">📜 災害対策基本法 ＝ ルールブック</div>
            <div style="font-size:13px; color:#374151; margin-top:4px;">「誰が、いつ、何をするか」の全体の枠組みを決める</div>
            <div style="font-size:12px; color:#6B7280; margin-top:2px;">→ 常に存在する基本ルール（平時から有効）</div>
          </div>
          <div class="column-org-arrow">▼ 災害が起きたら…</div>
          <div class="column-org-level" style="background:#FEF3C7; border-left:4px solid #F59E0B; padding:10px 14px;">
            <div style="font-size:15px; font-weight:bold;">🏥 災害救助法 ＝ 実行メニュー</div>
            <div style="font-size:13px; color:#374151; margin-top:4px;">避難所・食料・医療など「被災者に何を届けるか」を定める</div>
            <div style="font-size:12px; color:#6B7280; margin-top:2px;">→ 発災直後に適用される（応急段階）</div>
          </div>
          <div class="column-org-arrow">▼ 被害が特に甚大だと…</div>
          <div class="column-org-level" style="background:#FEE2E2; border-left:4px solid #EF4444; padding:10px 14px;">
            <div style="font-size:15px; font-weight:bold;">⚡ 激甚災害法 ＝ 特別な財政支援</div>
            <div style="font-size:13px; color:#374151; margin-top:4px;">復旧費用を国が大幅に肩代わりする特別措置</div>
            <div style="font-size:12px; color:#6B7280; margin-top:2px;">→ 復旧・復興段階で政令により指定</div>
          </div>
        </div>
        <p style="font-size:13px; color:#6B7280; margin-top:8px;">💡 基本法が<strong>誰が何をするか</strong>を決め、救助法が<strong>被災者に何を届けるか</strong>を実行し、被害が特に大きいときに激甚災害法が<strong>お金の面で特別に支援する</strong>。この3つがセットで動きます。</p>
      </div>

      <!-- 実例で見る：能登半島地震 -->
      <div class="column-section">
        <h3>📅 実例で見る 能登半島地震のとき</h3>
        <p>3つの法律がどういう順番で動くのか、能登半島地震の実例で見てみます。</p>
        <table class="column-table column-table-blue">
          <thead>
            <tr>
              <th>日付</th>
              <th>何が起きたか</th>
              <th>動いた法律</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2024年1月1日</td>
              <td>地震発生 → 災害対策本部を設置、救助を開始</td>
              <td>📜 災害対策基本法<br>🏥 災害救助法</td>
            </tr>
            <tr>
              <td>2024年1月11日</td>
              <td>被害が甚大 → 閣議で激甚災害に指定（本激）</td>
              <td>⚡ 激甚災害法</td>
            </tr>
            <tr>
              <td>2024年2月9日</td>
              <td>さらに追加指定</td>
              <td>⚡ 激甚災害法</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size:13px; color:#6B7280;">このように、まず基本法と救助法が<strong>すぐに</strong>動き、被害の全体像が見えてきた段階で激甚災害法が<strong>あとから</strong>適用されます。</p>
      </div>

      <!-- 1. 災害対策基本法 -->
      <div class="column-section">
        <h3>📜 災害対策基本法</h3>
        <p><strong>災害対策基本法</strong>（昭和36年制定）は、日本の災害対応のいちばん基本となる法律です。防災の憲法ともいわれています。</p>
        <p style="font-size:13px; color:#6B7280;">📖 国・県・市町村が「誰が何を担当するか」を決めたルールブックです。</p>
        <table class="column-table column-table-blue">
          <thead>
            <tr>
              <th>定めていること</th>
              <th>内容</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>役割分担</td>
              <td>国・都道府県・市区町村、それぞれ何をするかの責務を定めています</td>
            </tr>
            <tr>
              <td>災害対策本部</td>
              <td>誰が・いつ・どこに設置するかを定めています</td>
            </tr>
            <tr>
              <td>地域防災計画</td>
              <td>自治体ごとに策定する義務があります</td>
            </tr>
            <tr>
              <td>受援への配慮</td>
              <td>応援を受ける体制を整備します（第40条）</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size:13px; color:#6B7280;">⏰ <strong>いつ動く？</strong> → 平時から常に有効。災害が起きたらこの法律に基づいて対策本部が設置されます。</p>
      </div>

      <!-- 2. 災害救助法 -->
      <div class="column-section">
        <h3>🏥 災害救助法</h3>
        <p><strong>災害救助法</strong>は、被災した人たちへ具体的な救助（避難所設置、食料・飲料水、医療提供、仮設住宅など）を届けるための法律です。</p>
        <p style="font-size:13px; color:#6B7280;">📋 基本法が誰がやるかを決め、救助法は何を届けるかを決めます。</p>
        <p>災害対策基本法が<strong>枠組み（誰が何をするか）</strong>を定めるのに対し、災害救助法は<strong>実行（被災者に何を届けるか）</strong>を定めています。</p>
        <p>実施主体は<strong>都道府県知事</strong>です。つまり、県が中心となって救助を進めます。</p>
        <p style="font-size:13px; color:#6B7280;">⏰ <strong>いつ動く？</strong> → 一定規模以上の災害が発生したとき、発災直後に適用されます。</p>
      </div>

      <!-- 3. 激甚災害法 -->
      <div class="column-section">
        <h3>⚡ 激甚災害指定</h3>
        <p><strong>激甚災害に対処するための特別の財政援助等に関する法律</strong>（激甚災害法・昭和37年制定）は、被害が特に甚大な災害に対して、国の財政支援を大幅に引き上げる制度です。</p>
        <p style="font-size:13px; color:#6B7280;">💰 通常の補助では足りないほど大きな被害のとき、国が復旧費用を上乗せしてくれる仕組みです。</p>

        <p style="margin-top:10px;"><strong>他の2つの法律との違い</strong></p>
        <ul style="font-size:14px; line-height:1.7; margin:6px 0 10px 16px;">
          <li>基本法・救助法は<strong>人を助ける</strong>ための法律</li>
          <li>激甚災害法は<strong>お金を支援する</strong>ための法律</li>
          <li>基本法・救助法は<strong>すぐに動く</strong>が、激甚災害法は<strong>被害額の調査後に指定される</strong></li>
        </ul>

        <table class="column-table column-table-blue">
          <thead>
            <tr>
              <th>ポイント</th>
              <th>内容</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>指定の仕組み</td>
              <td>中央防災会議の意見を聴いた上で、<strong>政令（閣議決定）</strong>で指定されます</td>
            </tr>
            <tr>
              <td>指定の種類</td>
              <td><strong>本激</strong>（全国規模の大災害）と<strong>局激</strong>（市町村単位の局地的な災害）の2種類</td>
            </tr>
            <tr>
              <td>主な効果</td>
              <td>公共土木施設の復旧費、農林水産業・中小企業への支援など、<strong>国庫補助率が引き上げ</strong>られます</td>
            </tr>
            <tr>
              <td>指定基準の例</td>
              <td>本激：復旧費が全国標準税収入の0.5%超 など、数値基準で判定</td>
            </tr>
          </tbody>
        </table>
        <p>💡 激甚災害の指定は発災直後ではなく、被害額の調査後に閣議決定されます。シナリオの地震でも、今後被害が甚大と認定されれば指定される可能性があります。指定されると被災自治体の財政負担が大きく軽減されます。</p>
        <p style="font-size:13px; color:#6B7280;">⏰ <strong>いつ動く？</strong> → 発災後、被害額の調査を経て政令で指定されます（発災から数日〜数週間後）。</p>
      </div>

      <!-- 3. 組織図 -->
      <div class="column-section">
        <h3>🏢 災害時の組織図</h3>
        <p>災害対策本部とその中の保健医療福祉調整本部の関係を見てみます。</p>

        <div class="column-org-chart">
          <div class="column-org-level">
            <h4>🇯🇵 国</h4>
            <p>非常災害対策本部 / 緊急災害対策本部</p>
            <div class="column-org-sub">厚生労働省 災害対策本部 → 保健医療福祉活動支援チーム</div>
          </div>
          <div class="column-org-arrow">▼</div>
          <div class="column-org-level prefecture">
            <h4>🏛️ 都道府県</h4>
            <p>災害対策本部（知事が本部長）</p>
            <div class="column-org-sub green">🎯 <strong>保健医療福祉調整本部</strong><br>市区町村から上がってきたニーズに対応するためのリソースの配分調整を行います
            </div>
            <p style="margin-top:6px;">保健所 = 地域本部（県と市区町村をつなぐ）</p>
          </div>
          <div class="column-org-arrow">▼</div>
          <div class="column-org-level city">
            <h4>🏠 市区町村</h4>
            <p>災害対策本部（市区町村長が本部長）</p>
            <div class="column-org-sub orange">🎯
              <strong>保健医療福祉調整本部</strong><br>避難所の医療・保健ニーズの把握、要配慮者の安否確認、都道府県調整本部との情報連携を行います
            </div>
          </div>
        </div>

        <p>💡 <strong>保健医療福祉調整本部</strong>は常設ではなく、<strong>災害発生後に立ち上がる臨時組織</strong>です。県と市区町村の両方に災害対策本部が置かれます。</p>
      </div>

      <!-- 5. シナリオ接続 -->
      <div class="column-section">
        <h3>📋 平時にできること</h3>
        <table class="column-table column-table-blue">
          <thead>
            <tr>
              <th>やるべきこと</th>
              <th>理由</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>自県の担当課を調べる</td>
              <td>保健医療福祉調整本部の平時担当課を把握します</td>
            </tr>
            <tr>
              <td>地域防災計画の確認</td>
              <td>自分のクリニックがある自治体の計画を一度読んでおくと役立ちます</td>
            </tr>
            <tr>
              <td>医師会との連携確認</td>
              <td>地域医師会の災害時体制における自院の位置づけを確認します</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 6. シナリオ接続 -->
      <div class="column-callout-blue">
        <strong>🐱 マタタビクリニックの場合</strong><br>
        シーン4で「災害対策本部を設置」「災害救助法を適用」という速報が流れました。ニャンタ院長は「こういうことは事前に知っておくべきだった」と感じていました。こうした法的な枠組みを<strong>平時に知っておくこと</strong>が、いざという時の判断や行動を変えてくれます。
      </div>

      <!-- 7. 出典 -->
      <div class="column-source column-source-blue">
        <h3>📚 参考資料</h3>
        <ul>
          <li><a href="https://www.bousai.go.jp/taisaku/kihonhou/kihonhou_r7_01.html" target="_blank"
              rel="noopener noreferrer">内閣府 災害対策基本法等の改正（令和7年）</a></li>
          <li><a href="https://www.bousai.go.jp/taisaku/gekijinhukko/index.html" target="_blank"
              rel="noopener noreferrer">内閣府 激甚災害制度について</a></li>
          <li><a href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000055967.html" target="_blank"
              rel="noopener noreferrer">厚生労働省 大規模災害時の保健医療福祉活動に係る体制</a></li>
          <li><a href="https://www.wds.emis.go.jp/" target="_blank" rel="noopener noreferrer">EMIS（広域災害救急医療情報システム）</a>
          </li>
        </ul>
      </div>

      <div style="font-size:11px; color:#9CA3AF; text-align:center; margin-bottom:12px;">※
        本資料は2026年2月時点のものです。最新情報は各公式サイトをご確認ください。</div>

      <button class="btn-column-next-blue" onclick="continueFromColumnLegal()">グループ内で振り返ったら 第3幕へ →</button>
    </div>
  </div>

  <!-- ===========================
     SCREEN: COLUMN – DISASTER PRIORITY PHONE
=========================== -->
  <div id="screen-column-phone" class="screen">
    <div class="column-header">
      <h2>📞 コラム：災害時優先電話</h2>
      <p>クリニック・病院はどこまで使えるのか？ シーンの補足として知っておきたい知識をまとめました。</p>
    </div>
    <div class="column-body">

      <!-- 1. 制度概要 -->
      <div class="column-section">
        <h3>📋 災害時優先電話とは</h3>
        <p><strong>電気通信事業法 第8条</strong>（重要通信の確保）に基づく制度です。通信事業者は非常事態において「重要通信」を優先的に取り扱う義務があります。</p>
        <p>ただし、<strong>優先されるのは「発信」だけ</strong>。着信は一般電話と同じ扱いで、基地局が壊れていれば接続できません。</p>
      </div>

      <!-- 2. 優先の範囲 -->
      <div class="column-section">
        <h3>📊 何が優先されるのか</h3>
        <table class="column-table">
          <thead>
            <tr>
              <th>項目</th>
              <th>優先？</th>
              <th>備考</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>発信</strong></td>
              <td>○</td>
              <td>一般回線が規制中でも発信できます</td>
            </tr>
            <tr>
              <td><strong>着信</strong></td>
              <td>×</td>
              <td>一般電話と同じ扱いです</td>
            </tr>
            <tr>
              <td><strong>相手が話中</strong></td>
              <td>×</td>
              <td>割り込み機能ではありません</td>
            </tr>
            <tr>
              <td><strong>物理的な損壊</strong></td>
              <td>×</td>
              <td>基地局が壊れていれば不通です</td>
            </tr>
          </tbody>
        </table>
        <p>💡 つまり「<strong>回線混雑（輻輳）に対する優先措置</strong>」であり、インフラ損壊への保証ではありません。</p>
      </div>

      <!-- 3. 対象機関 -->
      <div class="column-section">
        <h3>🏥 誰が使えるのか</h3>
        <table class="column-table">
          <thead>
            <tr>
              <th>施設区分</th>
              <th>対象？</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>災害拠点病院</td>
              <td>✅ ほぼ確実</td>
            </tr>
            <tr>
              <td>救急告示病院等</td>
              <td>⚠️ 条件付きで可能性あり</td>
            </tr>
            <tr>
              <td><strong>一般診療所・クリニック</strong></td>
              <td>❌ 原則対象外の可能性が高い</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 4. よくある誤解 -->
      <div class="column-section">
        <h3>⚠️ よくある誤解</h3>
        <table class="column-table">
          <thead>
            <tr>
              <th>誤解</th>
              <th>実際</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>優先電話なら必ずつながる</td>
              <td>発信規制の回避のみです。基地局が損壊していれば不通です</td>
            </tr>
            <tr>
              <td>着信も優先される</td>
              <td>着信は一般と同じ扱いです</td>
            </tr>
            <tr>
              <td>データ通信も優先される</td>
              <td>音声通話のみが対象です。ネットは対象外です</td>
            </tr>
            <tr>
              <td>病院なら自動的に対象</td>
              <td>一般診療所は原則対象外です</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 5. 現実的対策 -->
      <div class="column-section">
        <h3>🛡️ クリニックが取るべき対策</h3>
        <p>優先電話に頼れない一般クリニックこそ、<strong>複数の通信手段を平時から整備</strong>しておくことが生命線です。</p>
        <table class="column-table">
          <thead>
            <tr>
              <th>手段</th>
              <th>特徴</th>
              <th>コスト</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>災害用伝言ダイヤル（171）</td>
              <td>毎月1日・15日に体験利用できます</td>
              <td>無料</td>
            </tr>
            <tr>
              <td>LINE / SNS（テキスト）</td>
              <td>音声通話より輻湊しにくいです</td>
              <td>無料</td>
            </tr>
            <tr>
              <td>SMS</td>
              <td>音声回線とは別経路です</td>
              <td>低額</td>
            </tr>
            <tr>
              <td>衛星電話（スターリンク等）</td>
              <td>地上インフラに依存しません</td>
              <td>高額</td>
            </tr>
          </tbody>
        </table>
        <p>📌 「電話 → SMS → LINE → 伝言ダイヤル」の順で試す<strong>連絡ツリー</strong>を印刷配布し、年1回以上の通信訓練をお勧めします。</p>
      </div>

      <!-- 6. ワークショップとの接続 -->
      <div class="column-callout">
        <strong>🐱 マタタビクリニックの場合</strong><br>
        一般無床診療所であるマタタビクリニックは、災害時優先電話の恩恵を直接受けられない可能性が高いです。だからこそ、<strong>複数の代替通信手段（LINE・SMS・衛星通信・災害用伝言ダイヤル）を平時から準備しておく</strong>ことが助けになります。
      </div>

      <!-- 7. 出典 -->
      <div class="column-source">
        <h3>📚 参考資料・情報源</h3>
        <ul>
          <li><a href="https://group.ntt/jp/disaster/3principles/tsushin.html" target="_blank"
              rel="noopener noreferrer">NTTグループ 防災（重要通信の確保）</a></li>
          <li><a href="https://group.ntt/jp/disaster/simulation/04.html" target="_blank"
              rel="noopener noreferrer">NTTグループ 防災シミュレーション</a></li>
          <li><a href="https://www.soumu.go.jp/menu_seisaku/ictseisaku/net_anzen/hijyo/yusen.html" target="_blank"
              rel="noopener noreferrer">総務省 非常時の通信確保</a></li>
          <li><a href="https://laws.e-gov.go.jp/law/359AC0000000086" target="_blank"
              rel="noopener noreferrer">電気通信事業法（e-Gov）</a></li>
          <li><a href="https://www.wds.emis.go.jp/" target="_blank" rel="noopener noreferrer">EMIS（広域災害救急医療情報システム）</a>
          </li>
        </ul>
      </div>

      <div style="font-size:11px; color:#9CA3AF; text-align:center; margin-bottom:12px;">※
        本資料は2026年2月時点のものです。最新情報は各公式サイトをご確認ください。</div>

      <button class="btn-column-next" onclick="continueFromColumn()">次のシーンへ進む →</button>
    </div>
  </div>

  <!-- ===========================
     SCREEN: COLUMN - VULNERABLE
=========================== -->
  <div id="screen-column-vulnerable" class="screen">
    <div class="column-header-emerald">
      <h2>💊 コラム：要配慮者と「もしものとき」を話しておく</h2>
      <p>透析・在宅酸素・車いすの患者さん。災害時にいちばん困るのは、あの患者さんが今どこにいるかわからないことです。かかりつけ医として、平時にできることを考えてみます。</p>
    </div>
    <div class="column-body">

      <!-- 1. かかりつけ医の立ち位置 -->
      <div class="column-section">
        <h3>🩺 かかりつけ医は何ができる？</h3>
        <p>正直なところ、災害時の要配慮者対応には<strong>全国統一のフローがあるわけではありません</strong>。地域の医師会や行政、事業者の体制によってやり方はさまざまです。</p>
        <p>ただ、混沌としているからこそ、ふだん患者さんを診ているかかりつけ医が<strong>「うちにはこういう患者さんがいる」と把握していること自体</strong>が大きな意味を持ちます。</p>
        <p>たとえばこんなことが考えられます。</p>
        <ul style="font-size:14px; line-height:1.8; margin:6px 0 0 16px;">
          <li>ふだんの診療で「災害のとき、自分で動けますか？」と聞いてみる</li>
          <li>自分で動ける方には、災害時にどう行動するかを一緒に考えておく</li>
          <li>動けない在宅患者さんは、リストにしておく</li>
        </ul>
      </div>

      <!-- 2. 在宅酸素（HOT） -->
      <div class="column-section">
        <h3>🫁 在宅酸素（HOT）と開業医の関わり</h3>
        <p>在宅酸素の患者さんは、多くの開業医が処方元として直接関わっています。災害時は<strong>停電でボンベ残量がゼロになる</strong>ことが最大のリスクです。</p>
        <p>酸素事業者の中には、<strong>24時間体制の緊急窓口</strong>を設けているところがあり、災害時は自社システムで被災エリアの患者を特定し、安否確認や予備ボンベの配送まで動く仕組みを持っている企業もあります。</p>
        <p>かかりつけ医としてやっておけるとよいことをまとめました。</p>
        <table class="column-table column-table-emerald">
          <tbody>
            <tr><td>患者さんごとに、<strong>酸素事業者名と緊急連絡先</strong>を把握しておく</td></tr>
            <tr><td>機器の種類（濃縮器かボンベか）、<strong>予備ボンベ・電源の有無</strong>を確認しておく</td></tr>
            <tr><td>患者さん自身が「停電時にボンベに切り替える」手順を理解しているか確認する</td></tr>
            <tr><td>自力で避難できるか、<strong>ADLや社会的サポートの状況</strong>を把握しておく</td></tr>
          </tbody>
        </table>
        <p style="font-size:13px; color:#6B7280;">※ 酸素事業者の災害対応体制は会社ごとに異なり、同意書の書式なども現在各社で見直しが進んでいるところです。</p>
      </div>

      <!-- 3. 透析 -->
      <div class="column-section">
        <h3>💉 透析についてかかりつけ医が知っておくと役立つこと</h3>
        <p>透析の患者さんは、多くの場合<strong>別の透析施設</strong>に通っています。災害時の受入調整は、日本透析医会の<strong>「災害時情報ネットワーク」</strong>や、地域の透析ネットワークが中心になって行います。</p>
        <p>開業医が直接この調整に入ることは少ないかもしれません。ただ、かかりつけ医として知っておくと助かる場面はあります。</p>
        <ul style="font-size:14px; line-height:1.8; margin:6px 0 0 16px;">
          <li>透析日が中1日空いた場合、中2日まで待てるかどうかの判断</li>
          <li>被災中の食事変化（塩分・カリウム・水分）に対する注意点のアドバイス</li>
          <li>その患者さんがどの透析施設に通っているか、把握しておくこと</li>
        </ul>
        <p style="font-size:13px; color:#6B7280;">※ 透析ネットワークの体制は地域差が大きく、機能している地域とそうでない地域があります。</p>
      </div>

      <!-- 4. リストを作る -->
      <div class="column-section">
        <h3>📋 「リスト」を作っておくという提案</h3>
        <p>決まったフォーマットがあるわけではありませんが、<strong>自院の要配慮な患者さんについて、最低限の情報をリスト化しておく</strong>ことは、災害時の初動を大きく変える可能性があります。</p>
        <table class="column-table column-table-emerald">
          <thead>
            <tr>
              <th>項目</th>
              <th>なぜ必要か</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>患者名・住所・家族連絡先</td>
              <td>安否確認の出発点になる</td>
            </tr>
            <tr>
              <td>治療内容（HOT / 透析 / 人工呼吸器など）</td>
              <td>緊急度の判断に直結する</td>
            </tr>
            <tr>
              <td>関係する事業者・施設の連絡先</td>
              <td>酸素事業者、透析施設など</td>
            </tr>
            <tr>
              <td>ADL・移動手段・社会的サポート</td>
              <td>自力で動けるかどうかで対応が変わる</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size:13px; color:#6B7280;">行政の要配慮者名簿と、事業者や病院が持つ患者リスト。これらをどう突き合わせるかは、地域ごとの課題です。各地の医師会でも取り組みが始まっていますが、統一されたフォーマットはまだありません。</p>
      </div>

      <!-- 5. まとめ -->
      <div class="column-callout-emerald">
        <strong>🐱 マタタビクリニックの場合</strong><br>
        三毛田チヨさんのことを思い出してください。ふだんは一人で通院できていても、災害時は「移動できない」「連絡がつかない」ことが起こります。<br><br>
        統一されたフローがないからこそ、<strong>かかりつけ医が「この患者さんは災害時に困るかもしれない」という意識を持っていること</strong>。それだけでも、いざというときの対応が変わってきます。
      </div>

      <!-- 出典 -->
      <div class="column-source column-source-emerald" style="margin-top:16px;">
        <h3>📚 参考</h3>
        <ul>
          <li><a href="https://touseki-ikai.or.jp/saigai-kankei/saigaiji-joho-nw/" target="_blank" rel="noopener noreferrer">日本透析医会 災害時情報ネットワーク</a></li>
          <li><a href="https://www.fukuda.co.jp/public/inhome_medical/saigai.html" target="_blank" rel="noopener noreferrer">フクダ電子 在宅酸素 災害時の対応</a></li>
          <li><a href="https://www.teijin-pharma.co.jp/project/story02.html" target="_blank" rel="noopener noreferrer">帝人ヘルスケア 災害対応の取り組み</a></li>
          <li><a href="https://www.jimga.or.jp/hot/" target="_blank" rel="noopener noreferrer">日本産業・医療ガス協会（JIMGA）在宅酸素療法</a></li>
          <li><a href="https://www.pref.tochigi.lg.jp/e04/nanbyo/saigaijitousekigaidorain.html" target="_blank" rel="noopener noreferrer">栃木県 災害時透析ガイドライン</a></li>
        </ul>
      </div>

      <button class="btn-column-next-emerald" onclick="continueFromColumnVulnerable()">ハザードマップを確認する →</button>
    </div>
  </div>


  <!-- ===========================
     SCREEN: COLUMN – BCP
=========================== -->
  <div id="screen-column-bcp" class="screen">
    <div class="column-header-green">
      <h2>📋 コラム：BCP（事業継続計画）</h2>
      <p>医療機関が倒れれば地域も倒れる。まず自分を守る計画としてのBCPを見ていきます。</p>
    </div>
    <div class="column-body">

      <!-- 図 -->
      <div class="column-section">
        <h3>📈 BCPの基本的な理念</h3>
        <p>BCPの目的は <strong>2つ</strong> あります。</p>
        <p>① <strong>スタッフと家族の安全・休息を確保</strong>する<br>② 病院・診療所を<strong>（なるべく）止めない</strong></p>
        <img src="bcp_diagram.png" alt="BCPの概念図：事前の備えとBCP発動による復旧・成長" class="column-diagram">
        <p style="font-size:11px; color:#9CA3AF; text-align:right;">図：浅野直先生スライドを改変</p>
        <p>災害対応マニュアルで初動を乗り切った後、<strong>BCP発動</strong>により「復旧」「成長」のラインに乗せるか、「縮小」「廃業」に向かうかが決まります。</p>
      </div>

      <!-- ヒト・モノ・カネ -->
      <div class="column-section">
        <h3>🧩 BCPを「ヒト・モノ・カネ」で整理する</h3>
        <table class="column-table column-table-green">
          <thead>
            <tr>
              <th>区分</th>
              <th>主なアクション</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>👤 ヒト</strong></td>
              <td>緊急連絡網・避難場所の共有、代診ネットワークの整備を行います</td>
            </tr>
            <tr>
              <td><strong>📦 モノ</strong></td>
              <td>医薬品・発電機・衛材の備蓄、電子カルテのクラウド化を行います</td>
            </tr>
            <tr>
              <td><strong>💰 カネ</strong></td>
              <td>キャッシュの確保、火災保険など・補助金・融資枠の確認を行います</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 3ステップ -->
      <div class="column-section">
        <h3>🚀 診療所BCPの3ステップ</h3>

        <p style="display:flex; align-items:center; margin-bottom:8px;"><span
            class="column-step-num">1</span><strong>脆弱性の把握</strong></p>
        <table class="column-table column-table-green">
          <tbody>
            <tr>
              <td>院内の安全点検</td>
              <td>建物耐震性、家具固定、非常口確保</td>
            </tr>
            <tr>
              <td>要配慮者リスト</td>
              <td>透析、在宅酸素、人工呼吸器、独居高齢者</td>
            </tr>
            <tr>
              <td>職員出勤可能性</td>
              <td>連絡先、居住地・通勤手段の確認・更新</td>
            </tr>
          </tbody>
        </table>

        <p style="display:flex; align-items:center; margin:12px 0 8px;"><span
            class="column-step-num">2</span><strong>最低限の備蓄確認（72時間分）</strong></p>
        <table class="column-table column-table-green">
          <tbody>
            <tr>
              <td>水</td>
              <td>1人1日3L × 職員数 × 3日分</td>
            </tr>
            <tr>
              <td>食料</td>
              <td>非常食、栄養補助食品</td>
            </tr>
            <tr>
              <td>医薬品</td>
              <td>慢性疾患薬を優先</td>
            </tr>
            <tr>
              <td>電源・通信</td>
              <td>ポータブル発電機（燃料72h分）、充電器</td>
            </tr>
          </tbody>
        </table>

        <p style="display:flex; align-items:center; margin:12px 0 8px;"><span
            class="column-step-num">3</span><strong>中長期的な備え</strong></p>
        <table class="column-table column-table-green">
          <tbody>
            <tr>
              <td>カルテ対策</td>
              <td>クラウド化（医療DX令和ビジョン2030との連動）</td>
            </tr>
            <tr>
              <td>重要書類</td>
              <td>保管場所の確認・バックアップ</td>
            </tr>
            <tr>
              <td>運転資金</td>
              <td>現金の確保（固定費3ヶ月分が目安）</td>
            </tr>
            <tr>
              <td>地域連携</td>
              <td>近隣医療機関や地域医師会との連携体制</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 法的状況 -->
      <div class="column-section">
        <h3>⚖️ BCP策定の法的状況（2025年7月現在）</h3>
        <table class="column-table column-table-green">
          <thead>
            <tr>
              <th>区分</th>
              <th>対象</th>
              <th>時期</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>法的義務</strong></td>
              <td>災害拠点病院</td>
              <td>2017年〜</td>
            </tr>
            <tr>
              <td><strong>法的義務</strong></td>
              <td>介護施設・訪問看護ST等</td>
              <td>2024年4月〜</td>
            </tr>
            <tr>
              <td><strong>努力義務</strong></td>
              <td>一般病院・診療所</td>
              <td>—</td>
            </tr>
          </tbody>
        </table>
        <p>💡 一般診療所は努力義務ですが、完璧を目指して何もしないよりも、<strong>不完全でも今日から始める</strong>ほうが確実に前に進めます。</p>
      </div>

      <!-- シナリオとの接続 -->
      <div class="column-callout-green">
        <strong>🐱 マタタビクリニックの場合</strong><br>
        シーン5で体験したように、薬品棚が固定されていなかった・非常用バッテリーの場所が共有されていなかったことで、発災直後の対応が遅れました。<br>
        BCPをヒト・モノ・カネで整備し、<strong>棚の固定、備蓄確認、連絡網の整備</strong>を平時から行っておくと、復旧がぐっとスムーズになります。
      </div>

      <!-- 出典 -->
      <div class="column-source column-source-green">
        <h3>📚 参考資料</h3>
        <ul>
          <li><a href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000089060.html" target="_blank"
              rel="noopener noreferrer">厚生労働省 医療施設の災害対応のためのBCP</a></li>
          <li>浅野直先生スライド（BCP概念図）改変</li>
          <li><a href="https://www.jmedj.co.jp/movie/detail.php?id=222" target="_blank"
              rel="noopener noreferrer">日本医事新報社「南海トラフ巨大地震対策を地域医療に活かす」（日本プライマリ・ケア連合学会）</a></li>
        </ul>
      </div>

      <div style="font-size:11px; color:#9CA3AF; text-align:center; margin-bottom:12px;">※
        本資料はワークショップ補足教材です。BCPの具体的な策定は厚生労働省ガイドラインを参照してください。</div>

      <button class="btn-column-next-green" onclick="continueFromColumnBCP()">シーン6へ進む →</button>
    </div>
  </div>

  <!-- ===========================
     SCREEN 8: BCP CHECKLIST
=========================== -->
  <div id="screen-bcp" class="screen">
    <div class="bcp-header">
      <h2>📋 BCPチェックリスト</h2>
      <p>あなたのクリニックは災害に備えていますか？ 4つの視点で確認してみます。</p>
    </div>
    <div class="bcp-body" id="bcp-body">
      <!-- Injected by JS -->
    </div>
  </div>

  <!-- ===========================
     SCREEN 9: SUMMARY
=========================== -->
  <div id="screen-summary" class="screen">
    <div class="summary-header">
      <div class="summary-emoji"><img src="ogp.png" alt="災害医療ワークショップ" style="width:100%; max-width:320px; height:auto; border-radius:16px;"></div>
      <div class="summary-title">ワークショップ完了！</div>
      <div class="summary-sub">5つの幕を通じて、地域医療を守るための<br>気づきを得ることができました</div>
    </div>
    <div class="summary-body">
      <div class="summary-key">
        <div class="summary-key-num">1</div>
        <div class="summary-key-content">
          <div class="summary-key-title">自分 → 家族 → 仕事の順番</div>
          <div class="summary-key-text">
            地震が起きた直後は、まず自分の安全を確保します。
            次に家族の安否を確認し、そのうえで仕事の対応に進みます。
            いざという時に落ち着いて動けるよう、普段から順番を決めておくと安心です。
          </div>
        </div>
      </div>
      <div class="summary-key">
        <div class="summary-key-num">2</div>
        <div class="summary-key-content">
          <div class="summary-key-title">コミュニケーション手段は2つ以上確保</div>
          <div class="summary-key-text">
            大規模災害では電話がつながりにくくなります。
            LINE、SMS、災害用伝言ダイヤル（171）、連絡ツリーなどを組み合わせて、
            複数の連絡手段を平時から決めておくと安心です。
          </div>
        </div>
      </div>
      <div class="summary-key">
        <div class="summary-key-num">3</div>
        <div class="summary-key-content">
          <div class="summary-key-title">平時の対話がBCPの基本</div>
          <div class="summary-key-text">
            要配慮者と「どこに避難するか」を話し合うこと、
            棚の固定や耐震確認、BCPを整備することは、
            災害時だけでなく日々の診療の質を高める備えにもなります。
          </div>
        </div>
      </div>

      <div class="action-plan-box">
        <h3>✍️ アクションプランニング</h3>
        <div style="font-size:13px; color:rgba(255,255,255,0.7); margin-bottom:10px; line-height:1.6;">
          このワークショップを受けて、明日から実践できることを書いてみてください。
        </div>
        <textarea class="action-input" id="action-input"
          placeholder="例：スタッフと連絡ツリーを作成する&#10;例：患者Aさんと避難場所を話し合う&#10;例：棚の固定をチェックする"></textarea>
        <div class="action-hint">スクリーンショットで保存できます 📸</div>
        <button class="btn-save-summary" id="btn-save-summary" type="button" onclick="downloadSummarySnapshotPng()">
          画像を保存
        </button>
      </div>
    </div>

    <div class="summary-footer">
      <p>
        地域医療を守るために、今日から一歩踏み出してみませんか 🐾
      </p>
      <button class="btn-restart" onclick="restart()">
        もう一度プレイする
      </button>
    </div>
  </div>

  <script>
    // ===========================
    // DATA: STORY SCENES
    // ===========================

    const STORY = {
      act1: {
        label: "第1幕",
        title: "発災！まず何から？",
        goal: "自分→家族→仕事の安全確認の順序を体感する。「当たり前」を決断する難しさを知る。",
        time: "約10分",
        facilNote: "まずグループで「あなたはどう行動しますか？」と話し合ってから選択肢を選びましょう。正解探しではなく、みんなの最初の判断を共有することが大切です。",
        headerSub: "第1幕：発災直後の初動",
        scenes: [
          {
            id: "1-1",
            label: "第1幕 シーン1",
            messages: [
              { type: "narrator", text: "訪問診療の帰り道。午前10時45分。" },
              { type: "narrator", text: "突然、車が大きく揺れた。緊急速報がけたたましく鳴り響く。" },
              { type: "system", text: "⚡️ 緊急地震速報\nただいま強い地震が発生しています。揺れに警戒してください。" },
              { type: "narrator", text: "揺れが収まった。前を見ると、道路の一部が大きくめくれあがっていた。" },

              // <!-- 画像挿入ポイント：陥没した道路の画像 -->
              // { type: "system", text: `<div class="image-placeholder" style="width: 100%; height: 120px; background: rgba(0,0,0,0.1); border: 2px dashed rgba(0,0,0,0.3); border-radius: 8px; margin: 8px 0; display: flex; align-items: center; justify-content: center; color: #666; font-size: 11px;">陥没した道路の画像</div>` },

              { type: "nanta", text: "うわっ……！ 止まれた。道が……陥没している。" },
              { type: "narrator", text: "他にも数台の車が路肩に止まっている。遠くから火災らしき煙も見える。" },
              { type: "narrator", text: "<img src='earthquake_scene.png' alt='地震で損傷した道路' style='width: 100%; max-width: 360px; border-radius: 12px; margin: 8px auto; display: block; box-shadow: 0 4px 12px rgba(0,0,0,0.15);'>" }
            ],
            question: "あなたはまず何をしますか？",
            choices: [
              {
                letter: "A",
                text: "すぐにクリニックに電話してスタッフと患者の状況を確認する",
                quality: "rethink",
                comment: "医療者としての責任感からクリニックを心配する気持ちはわかりますが、まず自分の安全確認が先です。自分が負傷していては診療どころではありません。",
                bestComment: "B → 支援者となるためには、まず自分自身の安全確保（Do no harmの前提）が必要です"
              },
              {
                letter: "B",
                text: "車を安全な場所（広場など）に止め直し、自分の身体状況と周囲の危険を確認する",
                quality: "great",
                comment: "正しい優先順位です！支援を行うための大前提は「支援者自身が安全であること」です。まずご自身の無事を確認することから始めましょう。",
                bestComment: null
              },
              {
                letter: "C",
                text: "訪問診療で先ほど訪問した患者宅に引き返す",
                quality: "rethink",
                comment: "患者さんを心配する気持ちは大切ですが、道路が陥没しガス漏れ等の危険な状況下では、まず自分の安全確認が必要です。二次災害に巻き込まれる恐れがあります。",
                bestComment: "B → まず自分の身体・環境の安全確認"
              }
            ],
            nextScene: "1-2"
          },
          {
            id: "1-2",
            label: "第1幕 シーン2",
            preMessages: [
              { type: "narrator", text: "車を路肩に止め、身体を確認した。打撲はない。無事だ。" },
              { type: "nanta", text: "よし……動ける。次は家族に連絡しないと。" },
              { type: "narrator", text: "スマホを取り出す。しかし、発信音がしない。電話回線が混雑している。" },
              { type: "system", text: "📵 通話がつながりにくい状況です。\n回線が集中しています。" }
            ],
            question: "家族への連絡手段はどれにしますか？",
            choices: [
              {
                letter: "A",
                text: "公衆電話を探す。固定電話ならつながるかもしれない",
                quality: "ok",
                comment: "公衆電話は災害時に無料開放されることがありますが、場所を探す時間がかかります。まずは手元の手段を試しましょう。",
                bestComment: "B → SNSやLINEの安否確認機能は回線が少なくてすむため有効"
              },
              {
                letter: "B",
                text: "LINEの安否確認メッセージやSNSのステータス機能を使う",
                quality: "great",
                comment: "正解！音声通話と比べてデータ通信は少ない帯域で動くため、回線混雑時でも届きやすい。LINEの安否確認機能は特に有効です。",
                bestComment: null
              },
              {
                letter: "C",
                text: "連絡を後回しにして、直接自宅に向かう",
                quality: "rethink",
                comment: "家族の安否を後回しにすると、心配が判断の邪魔をします。また移動中の二次災害リスクもあります。まずデジタルで連絡を試みましょう。",
                bestComment: "B → まずテキスト・SNSで安否確認"
              }
            ],
            learningPoint: "自分 → 家族 → 仕事の順番が基本。\n音声回線は輻輳（混雑）しやすい。テキスト・SNSを活用しよう。",
            nextAct: "act2"
          }
        ]
      },
      act2: {
        label: "第2幕",
        title: "通信が使えない…",
        goal: "複数のコミュニケーション手段の必要性を体感し、情報収集のルートを知る。",
        time: "約10分",
        facilNote: "通信が途絶えた経験はありますか？グループで「どんな連絡手段を持っているか」を確認し合ってから選択肢を選んでみましょう。",
        headerSub: "第2幕：コミュニケーション・情報収集",
        scenes: [
          {
            id: "2-1",
            label: "第2幕 シーン3",
            messages: [
              { type: "narrator", text: "揺れがおさまったのを確認し、路肩に車を停めた。時刻は午前10時57分。" },
              { type: "narrator", text: "まず自分の体を確認する。打撲はあるが、大きな怪我はなさそうだ。" },
              { type: "nanta", text: "家族は……クリニックのスタッフは……みんな無事か？" },
              { type: "narrator", text: "スマホを手にとる。電波は1本。いつ切れてもおかしくない状況だ。" }
            ],
            question: "家族とクリニックへの連絡、どうしますか？",
            choices: [
              {
                letter: "A",
                text: "スタッフの携帯に順番に電話をかけ続ける",
                quality: "ok",
                comment: "電話は確実に話せますが、回線輻輳で繋がらない可能性が高い。一手段に頼らず複数手段を並行して使うことが大切です。",
                bestComment: "C → 連絡ツリー＋複数手段を平時から準備しておく"
              },
              {
                letter: "B",
                text: "メールを一斉送信する。見てくれるはずだ",
                quality: "rethink",
                comment: "メールは届いても気づかれにくく、停電でPCが使えない状況も考えられます。受信確認もできません。",
                bestComment: "C → 事前に決めた連絡ツリーと複数手段の組み合わせが必要"
              },
              {
                letter: "C",
                text: "事前に決めていた連絡ツリーを使い、LINE・SMS・災害用伝言ダイヤル（171）を並行して使う",
                quality: "great",
                comment: "最善の選択です！平時に「連絡ツリー」と複数の通信手段を整備しておくことで、こうした状況でも確実に連絡が取れます。",
                bestComment: null
              }
            ],
            nextScene: "2-info"
          },
          {
            id: "2-info",
            label: "第2幕 シーン 情報収集",
            messages: [
              { type: "narrator", text: "迂回路を走りながら、外の様子が気になる。道路の陥没、崩れた塀、停車した車……被害はかなり広範囲のようだ。" },
              { type: "nanta", text: "全体でどれだけの被害が出ているんだろう。情報を集めないと……" },
              { type: "narrator", text: "スマホを手にとるが、ニュースサイトはなかなかつながらない。" }
            ],
            question: "被害の全体像を把握するために、まずどうしますか？",
            choices: [
              {
                letter: "A",
                text: "X（旧Twitter）やSNSで「またたび市 地震」と検索する",
                quality: "ok",
                comment: "SNSにはリアルタイム情報が集まりますが、デマや誤情報も多く混在します。公式情報と必ず照合しましょう。",
                bestComment: "B → 平時から公式の防災アプリを入れておくと、信頼性の高い情報にすぐアクセスできます"
              },
              {
                letter: "B",
                text: "スマホの防災アプリ（NHKニュース・防災、Yahoo!防災速報など）を開く",
                quality: "great",
                comment: "正解です！「NHKニュース・防災」や「Yahoo!防災速報」は、緊急地震速報・避難情報・被害状況を公式情報としてリアルタイムで届けてくれます。みなさん、スマホにこうした防災アプリは入っていますか？",
                bestComment: null
              },
              {
                letter: "C",
                text: "カーラジオをつける",
                quality: "ok",
                comment: "ラジオは停電時でも使えて信頼性が高い優れた手段です。防災アプリと組み合わせるのが理想的です。",
                bestComment: "B＋C → 防災アプリとラジオの組み合わせが最強"
              }
            ],
            learningPoint: "【主な防災アプリ一覧】\n・NHKニュース・防災（緊急速報＋ニュース映像）\n・Yahoo!防災速報（地震・津波・大雨など多ハザード対応）\n・避難所マップ hinanjyo.jp（全国避難所・開設状況をリアルタイム表示）https://www.hinanjyo.jp/\n・ゆれコール（地震早期警報・到達時刻予測）\n・災害用伝言板 Web171（NTT安否確認）\n・各キャリアのエリアメール（自動受信・設定不要）\n\n平時に入れておくだけで、いざというとき大きな差になります！",
            nextScene: "2-2"
          },
          {
            id: "2-2",
            label: "第2幕 シーン4",
            preMessages: [
              { type: "system", text: "📡 【防災アプリで判明した被害状況】\n\n・市内の複数建物倒壊、主要道路が土砂崩れ等で寸断（南西側市道のみ一部通行可）\n・またたび中央病院など3つの主要施設が被災・機能不全\n・死傷者多数（現在も被害の全容は不明）\n・一部停電、断水地区あり、インターネット接続不安定\n・避難所開設" },
              { type: "narrator", text: "連絡ツリーを使い、家族の無事を確認。スタッフ4人のうち3人の安否も取れた。1人は道路寸断で来られないが無事とのこと。" },
              { type: "narrator", text: "迂回路を通り、なんとかクリニックに到着した。午前11時30分。" },
              { type: "narrator", text: "クリニックは建物の外観は無事で、電気も復旧している。" },
              { type: "nanta", text: "よかった……。さあ、クリニックを再開する準備を——" },
              { type: "system", text: "📺 【速報】政府はまたたび市を含む一帯の震災について、災害対策本部を設置。県は災害救助法の適用を決定しました。" },
              { type: "nanta", text: "災害対策本部に災害救助法……聞いたことはあるけど、具体的にどういう仕組みなんだろう。今はもう調べる余裕もない……。こういうことは事前に知っておくべきだったな……。" },
              { type: "narrator", text: "災害対策本部の設置、災害救助法の適用、保健医療福祉調整本部……大規模災害時の法的枠組みを事前に知っておくことが、いざという時の行動を変える。ここで少し確認しておこう。" }
            ],
            nextAct: "act3",
            column: "column-legal"
          }
        ]
      },
      act3: {
        label: "第3幕",
        title: "クリニックをどう守るか",
        goal: "患者との事前の対話と、クリニックの物理的・制度的備えの重要性を理解する。",
        time: "約10分",
        facilNote: "この幕では「患者との平時の対話」と「クリニックの備え（人・モノ・通信・お金）」を分けて考えます。グループで、自院で明日から着手できる行動を1つ決めてから選択肢を選んでみましょう。",
        headerSub: "第3幕：患者・クリニックの対応",
        scenes: [
          {
            id: "3-1",
            label: "第3幕 シーン5",
            preMessages: [

              // <!-- 画像挿入ポイント：棚から薬が散乱している画像 -->
              // { type: "system", text: `<div class="image-placeholder" style="width: 100%; height: 120px; background: rgba(0,0,0,0.1); border: 2px dashed rgba(0,0,0,0.3); border-radius: 8px; margin: 8px 0; display: flex; align-items: center; justify-content: center; color: #666; font-size: 11px;">散乱した医薬品の画像</div>` },

              { type: "narrator", text: "クリニックの診察室に戻ると、薬品棚が傾き、一部の薬が床に散乱していた。" },
              { type: "nanta", text: "……棚が固定されていなかった。薬が……使えなくなったものがある。" },
              { type: "staff", text: "先生、非常用バッテリーの場所ってどこでしたっけ？ 備え付けの場所がわからなくて……" },
              { type: "nanta", text: "（BCPを整備しておくべきだったな……）" }
            ],
            question: "平時の備えとして、何が最も重要だったでしょうか？",
            choices: [
              {
                letter: "A",
                text: "十分な在庫（薬・消耗品）を確保しておくだけでよい",
                quality: "ok",
                comment: "在庫確保は大切ですが、棚が倒れれば薬も使えなくなります。ハードとソフトの両方の備えが必要です。",
                bestComment: "B → 棚の固定・耐震、BCPの整備が物的・人的な備えの基本"
              },
              {
                letter: "B",
                text: "棚の固定・建物耐震確認・BCPの整備（人・モノ・通信・お金の4項目）",
                quality: "great",
                comment: "最善の選択です！BCPは4つの柱（人・モノ・通信・お金）で考えます。建物・設備の物理的な備えと、スタッフが動ける仕組み作りが両輪です。",
                bestComment: null
              },
              {
                letter: "C",
                text: "火災保険や地震保険をしっかりかけておけばよい",
                quality: "rethink",
                comment: "保険も大切ですが、発災直後の対応には役立ちません。BCPは「継続して診療できるか」という観点で整備するものです。",
                bestComment: "B → 棚の固定・耐震確認・BCPの整備が優先"
              }
            ],
            learningPoint: "「人・モノ・通信・お金」の4視点でBCPを整備しよう。\n要配慮者との平時の対話が、災害時の安全網になる。",
            nextScene: "3-2"
          },
          {
            id: "3-2",
            label: "第3幕 シーン6",
            messages: [
              { type: "narrator", text: "発災から3日目。クリニックの診療を再開し、患者への連絡対応が続いていた。" },
              { type: "staff", text: "先生、昨日来る予定だった車いすの三毛田チヨさんが、今日も来られていないんです。電話もつながらなくて……心配で。" },
              { type: "nanta", text: "三毛田さんか……。事前に避難経路や緊急連絡先を確認しておかなかったな……。" },
              { type: "narrator", text: "三毛田チヨさんは下肢障害のある患者で、車いすなしには外出できない。家族は遠方で、ふだんは独居だ。" }
            ],
            question: "こうした状況を防ぐために、普段からできることは何でしたか？",
            choices: [
              {
                letter: "A",
                text: "災害時は市の行政や民生委員が対応してくれるはず",
                quality: "rethink",
                comment: "行政・民生委員も大切な役割ですが、大規模災害時は人手が圧倒的に不足します。とくに移動に支援が必要な患者さんには、かかりつけ医との日常的な関係が重要な安全網になります。",
                bestComment: "B → 普段の診療で「避難先」「緊急連絡先」を確認しておく"
              },
              {
                letter: "B",
                text: "普段の診療のなかで「どこに避難するか」「誰に助けてもらうか」を話し合っておく",
                quality: "great",
                comment: "正解！かかりつけ医は患者さんの生活・家族状況をよく知っています。移動に支援が必要な患者さんほど、日常診療の中で「災害時個別避難計画」の話題を出しておくことが最大の備えです。",
                bestComment: null
              },
              {
                letter: "C",
                text: "緊急連絡先だけカルテに記録しておけば十分",
                quality: "ok",
                comment: "緊急連絡先の把握は必要ですが、「誰がどこに避難するか・どう移動するか」まで具体化しておかないと、災害時に動けません。車いすユーザーには特に具体的な計画が必要です。",
                bestComment: "B → 「どこに逃げるか・どう移動するか」まで話し合っておくことが重要"
              }
            ],
            learningPoint: "【要配慮者とは、平時に話しておく】\n\n車いすの方、透析・在宅酸素（HOT）の方など、災害時に自力での避難や治療継続が難しい患者さんがいます。ふだんの診療の中で「どこに逃げるか」「誰に連絡するか」を話しておくことが、いちばんの備えになります。\n\n💡 リストを作っておく\n・透析…施設名、曜日、移動手段、家族連絡先\n・HOT…機器種別、予備ボンベ・電源の有無、酸素事業者の緊急連絡先\n・車いす・独居…避難先、移動手段、支援してくれる人\n\n💡 災害時、実際に動くのは誰？\n・透析 → かかりつけの透析施設が中心。日本透析医会の災害時情報ネットワークで受入調整が行われます\n・HOT → 酸素事業者が中心。24時間体制で安否確認・ボンベ配送まで対応する企業もあります\n・開業医の役割は、自院にこうした患者さんがいることを把握し、いざという時に正しい連絡先を知っていることです\n\n※ 透析ネットワークや事業者の体制は地域によって異なります。自分の地域ではどうなっているか、平時に確認しておくと安心です。",
            nextAct: "hazard",
            nextAfterBCP: "act4"
          }
        ]
      },
      act4: {
        label: "第4幕",
        title: "あのスタッフへの声かけ",
        goal: "スタッフのメンタル面に気を配り、PFA（心理的応急処置）の視点を持つ。",
        time: "約15〜20分",
        facilNote: "発災から時間が経ち、疲労が蓄積する時期です。身近なスタッフのケアも管理者の重要な役割です。",
        headerSub: "第4幕：発災1週間後〜スタッフのケアとPFA〜",
        scenes: [
          {
            id: "4-1",
            label: "第4幕 シーン7",
            messages: [
              { type: "narrator", text: "発災から1週間が経過。診療所の体制を無理やり回している。" },
              { type: "narrator", text: "そんな中、事務スタッフのめっけさん（35歳）の顔色が優れないことに気づいた。" },
              { type: "mekke", text: "院長……少しだけお時間いいですか。家のこともあって、最近ほとんど眠れていなくて……。" },
              { type: "nanta", text: "（めっけさん、少し様子がおかしいな。疲労がたまっているのだろうか……声をかけてみようか。）" }
            ],
            question: "どのようにめっけさんに声をかけ、話を聞きますか？",
            choices: [
              {
                letter: "S",
                text: "【シミュレーション開始】めっけさんの状況を聞き取る",
                quality: "ok",
                comment: "シミュレーションツールを開いて話し合いを行いましょう。\n会話が終わったら「終了」とのみ入力してください。会話内容をもとにフィードバックが開始されます。",
                bestComment: null,
                action: "open_simulation"
              }
            ],
            nextScene: "4-2"
          },
          {
            id: "4-2",
            label: "第4幕 シーン8",
            preMessages: [
              { type: "system", text: "📋 【めっけさんの状況サマリ】\n\n・被災し自宅が全壊判定\n・避難所で暮らしながら通勤中\n・同居の両親も避難所にいるが、65歳の母親は避難中に足を負傷\n・70歳の父親はトイレが遠いため水分を控え、元気がなくなっている\n・めっけさん自身も周囲の物音で眠れず、今後の見通しが立たず落ち込んでいる" },
              { type: "narrator", text: "想像以上に過酷な状況だった。管理者としてどうサポートできるだろうか。" },
              { type: "system", text: "💡 【PFA（心理的応急処置）に基づいた対応】\n\n・準備 (Preparation)：まず自分自身の安全や基本ニーズの確認。\n・見る (Look)：安全の確認、急な支援が必要な人はいないか。\n・聞く (Listen)：無理に聞き出さず、そばにいて安心させる。\n・つなぐ (Link)：必要な情報や専門的なサポートへつなげる。" }
            ],
            question: "PFAの視点を踏まえ、めっけさんに何と声をかけ、どう対応しますか？",
            choices: [
              {
                letter: "A",
                text: "「大変だったね。まずは休んで、お父さんの水分補給のことなど関係機関につなげよう」",
                quality: "great",
                comment: "正解です！「眠れないのは当然の反応だよ（Normalization: 正常化）」「同じように悩んでいる人も多いよ（Generalization: 普遍化）」と伝えつつ、無理に励まさず状況を受容し、具体的な支援（つなぐ）を提案できているPFAに沿った良い対応です。",
                bestComment: null
              },
              {
                letter: "B",
                text: "「みんな辛いから、今は頑張るしかないよ。仕事に集中して気を紛らわそう」",
                quality: "rethink",
                comment: "励ましのつもりでも、プレッシャーを与えてしまいます。「聞く」姿勢を取り、相手のペースを尊重しましょう。",
                bestComment: "A → PFAの原則（安全・安心感の確保）を優先する"
              },
              {
                letter: "C",
                text: "「辛いなら無理せず1ヶ月くらい休んでいいよ」",
                quality: "ok",
                comment: "配慮は必要ですが、いきなり長期休暇を指示すると逆に疎外感を感じさせてしまうことがあります。まずは具体的な困りごとのサポート（つなぐ）を相談しましょう。",
                bestComment: "A → 今日の安全と具体的な情報・支援への接続を優先"
              }
            ],
            learningPoint: "スタッフも被災者です。管理者として PFA（心理的応急処置）の見る・聞く・つなぐを意識したケアが助けになります。",
            nextAct: "act5"
          }
        ]
      },
      act5: {
        label: "第5幕",
        title: "支援の受け入れ（受援力）",
        goal: "中長期的な視点での地域連携と外部支援（PCAT等）の受け入れをシミュレーションする。",
        time: "約20分",
        facilNote: "自分たちだけで抱え込まず、どう外部支援を効果的に活用するか（受援力）をディスカッションします。",
        headerSub: "第5幕：発災1ヶ月後〜地域連携と受援力〜",
        scenes: [
          {
            id: "5-1",
            label: "第5幕 シーン9",
            messages: [
              { type: "narrator", text: "さらに時が経ち、発災から1ヶ月後（地震から約4週間）。" },
              { type: "narrator", text: "地域の急性期対応が落ち着き始め、医師会から「状況報告のために集まろう」と連絡があり、会合に出席した。" },
              { type: "system", text: "🏥 【外部チームからの提案】\nDMAT、JMAT等急性期の救護班の活動に目処が立ち、今後のケアを地域の医療者へ引き継ぎたい。" },
              { type: "nanta", text: "（引き継ぐといっても……自分自身も目の前の診療で手一杯だ。）" },
              { type: "nanta", text: "（まだクリニックも十分に片付いてないし、やることは山積みだ……）" },
              { type: "narrator", text: "そんな時、Primary Care Assistance Team（PCAT）の事務局から「メディカルスタッフを派遣できる可能性がある」と連絡が入った。" }
            ],
            choices: [
              {
                text: "🤝 PCATについて知る",
                comment: "",
                action: "column-pcat"
              }
            ],
            nextAct: "summary"
          }
        ]
      }
    };

    const BCP_DATA = [
      {
        icon: "👥",
        name: "人",
        sub: "スタッフ・体制",
        color: "#3B82F6",
        bg: "rgba(59,130,246,0.1)",
        items: [
          { text: "スタッフの緊急連絡先リストを整備している", detail: "携帯・自宅・家族の連絡先を含む" },
          { text: "連絡ツリー（連絡網）を決めている", detail: "誰が誰に連絡するかの役割分担" },
          { text: "在院できないスタッフが出た場合の代替体制がある", detail: "最低限の人数での診療プランを策定" },
          { text: "スタッフ自身の家族安否確認の優先を認めている", detail: "スタッフが安心して働けるルール作り" }
        ]
      },
      {
        icon: "📦",
        name: "モノ",
        sub: "設備・備品・物品",
        color: "#10B981",
        bg: "rgba(16,185,129,0.1)",
        items: [
          { text: "棚・大型機器を壁や床に固定している", detail: "転倒防止の耐震固定（L型金具等）" },
          { text: "発電機・非常用電源を確保している", detail: "稼働状況・燃料も定期確認" },
          { text: "3日分以上の医薬品・消耗品の在庫がある", detail: "ローリングストック方式で管理" },
          { text: "重要書類・データのバックアップをとっている", detail: "クラウドまたは別拠点での保管" }
        ]
      },
      {
        icon: "📡",
        name: "通信",
        sub: "情報・コミュニケーション",
        color: "#F59E0B",
        bg: "rgba(245,158,11,0.1)",
        items: [
          { text: "2種類以上の連絡手段を確保している", detail: "電話・LINE・SMS・災害用伝言ダイヤル（171）など" },
          { text: "患者さんへの一斉連絡手段がある", detail: "SNS・電話リスト・地域の見守りネット" }
        ]
      },
      {
        icon: "💰",
        name: "お金",
        sub: "財務・保険・資金",
        color: "#EF4444",
        bg: "rgba(239,68,68,0.1)",
        items: [
          { text: "診療停止時の固定費を3ヶ月以上賄える資金準備がある", detail: "家賃・人件費・リース等の固定費" },
          { text: "医業継続保険（休業補償）に加入している", detail: "災害時の休業損失をカバー" },
          { text: "BCP（事業継続計画）文書を作成・更新している", detail: "年1回の見直しが推奨される" },
          { text: "地域の医師会・連合会のBCP支援を把握している", detail: "支援制度・ネットワークを事前確認" }
        ]
      }
    ];

    // ===========================
    // STATE
    // ===========================
    let currentAct = null;
    let currentSceneIndex = 0;
    let currentScene = null;
    let messageQueue = [];
    let isAnimating = false;
    let checkedItems = {};
    let totalBCPItems = 0;
    let nextSceneAfterAppsGuide = null;
    let nextActAfterBCP = 'summary';
    let messageRunId = 0;
    let chatAutoFollow = true;

    // ===========================
    // SCREEN MANAGEMENT
    // ===========================
    function showScreen(name) {
      closeJumpMenu();
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      const targetScreen = document.getElementById('screen-' + name);
      if (!targetScreen) return;
      targetScreen.classList.add('active');
      targetScreen.scrollTop = 0;
      requestAnimationFrame(() => {
        targetScreen.scrollTop = 0;
      });
      window.scrollTo(0, 0);
    }

    function updateProgress(val) {
      const bar = document.getElementById('progress-bar-wrap');
      const fill = document.getElementById('progress-bar');
      const label = document.getElementById('act-label');
      if (val > 0) {
        bar.classList.add('visible');
        label.classList.add('visible');
        fill.style.width = val + '%';
      } else {
        bar.classList.remove('visible');
        label.classList.remove('visible');
      }
    }

    function setActLabel(text) {
      document.getElementById('act-label').textContent = text;
    }

    function toggleJumpMenu(forceOpen) {
      const menu = document.getElementById('jump-menu');
      const overlay = document.getElementById('jump-menu-overlay');
      const toggleBtn = document.getElementById('menu-toggle-btn');
      if (!menu || !overlay || !toggleBtn) return;

      const shouldOpen = typeof forceOpen === 'boolean' ? forceOpen : !menu.classList.contains('open');
      menu.classList.toggle('open', shouldOpen);
      overlay.classList.toggle('visible', shouldOpen);
      toggleBtn.setAttribute('aria-expanded', String(shouldOpen));
    }

    function closeJumpMenu() {
      toggleJumpMenu(false);
    }

    function reloadPage() {
      closeJumpMenu();
      window.location.reload();
    }

    function shareApp() {
      closeJumpMenu();
      const url = 'https://shoei05.github.io/trpg/';

      // シェアダイアログを表示
      let overlay = document.getElementById('share-overlay');
      if (overlay) overlay.remove();

      overlay = document.createElement('div');
      overlay.id = 'share-overlay';
      overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:10000;display:flex;align-items:center;justify-content:center;';
      overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };

      const dialog = document.createElement('div');
      dialog.style.cssText = 'background:#fff;border-radius:16px;padding:24px;margin:16px;max-width:360px;width:100%;box-shadow:0 8px 32px rgba(0,0,0,.2);';
      dialog.innerHTML = `
        <div style="font-size:16px;font-weight:bold;margin-bottom:12px;">📤 このアプリをシェア</div>
        <div style="display:flex;align-items:center;gap:8px;background:#F3F4F6;border-radius:8px;padding:10px 12px;">
          <span style="flex:1;font-size:13px;color:#374151;word-break:break-all;user-select:all;">${url}</span>
          <button id="share-copy-btn" style="flex-shrink:0;background:#3B82F6;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:bold;cursor:pointer;white-space:nowrap;">コピー</button>
        </div>
        <button id="share-close-btn" style="display:block;margin:14px auto 0;background:none;border:none;color:#6B7280;font-size:13px;cursor:pointer;">閉じる</button>
      `;
      overlay.appendChild(dialog);
      document.body.appendChild(overlay);

      document.getElementById('share-copy-btn').onclick = () => {
        navigator.clipboard.writeText(url).then(() => {
          document.getElementById('share-copy-btn').textContent = 'コピーしました';
          document.getElementById('share-copy-btn').style.background = '#10B981';
          setTimeout(() => overlay.remove(), 1200);
        }).catch(() => {
          prompt('URLをコピーしてください：', url);
        });
      };
      document.getElementById('share-close-btn').onclick = () => overlay.remove();
    }

    function showToast(msg) {
      let t = document.getElementById('share-toast');
      if (!t) {
        t = document.createElement('div');
        t.id = 'share-toast';
        t.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:#1F2937;color:#fff;padding:10px 20px;border-radius:24px;font-size:14px;z-index:10000;opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap;box-shadow:0 4px 12px rgba(0,0,0,.3);';
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.style.opacity = '1';
      setTimeout(() => { t.style.opacity = '0'; }, 2000);
    }

    function jumpToOpeningDoor() {
      jumpToActDoor('act1');
    }

    function jumpToActDoor(actKey) {
      if (!STORY[actKey]) return;
      messageRunId += 1;
      if (actKey === 'act1') {
        checkedItems = {};
        currentAct = null;
        currentSceneIndex = 0;
        currentScene = null;
        messageQueue = [];
        nextActAfterBCP = 'summary';
        updateProgress(0);
      }
      nextSceneAfterAppsGuide = null;
      showChoiceArea(false);
      document.getElementById('chat-body').innerHTML = '';
      showActBreak(actKey, function () {
        startAct(actKey);
      });
    }

    function findSceneById(sceneId) {
      for (const [actKey, act] of Object.entries(STORY)) {
        const sceneIndex = act.scenes.findIndex(s => s.id === sceneId);
        if (sceneIndex !== -1) {
          return { actKey, act, scene: act.scenes[sceneIndex], sceneIndex };
        }
      }
      return null;
    }

    function jumpToScreen(screenName) {
      messageRunId += 1;
      nextSceneAfterAppsGuide = null;
      showChoiceArea(false);

      if (screenName === 'column-phone') {
        showColumnPhone();
        return;
      }
      if (screenName === 'column-bcp') {
        showColumnBCP('3-2');
        return;
      }
      if (screenName === 'column-vulnerable') {
        showColumnVulnerable('hazard');
        return;
      }
      if (screenName === 'column-legal') {
        showColumnLegal();
        return;
      }
      if (screenName === 'column-mental') {
        showColumnMental();
        return;
      }
      if (screenName === 'column-pcat') {
        showColumnPcat();
        return;
      }
      if (screenName === 'hazard') {
        goToHazard('summary');
        return;
      }
      if (screenName === 'bcp') {
        nextActAfterBCP = 'summary';
        showBCP();
        return;
      }
      if (screenName === 'summary') {
        showSummary();
        return;
      }
      if (screenName === 'news' || screenName === 'title') {
        currentAct = null;
        currentScene = null;
        messageQueue = [];
        updateProgress(0);
      }
      showScreen(screenName);
    }

    function jumpToScene(sceneId) {
      const found = findSceneById(sceneId);
      if (!found) return;
      const { actKey, act, scene, sceneIndex } = found;

      currentAct = actKey;
      currentSceneIndex = sceneIndex;
      nextSceneAfterAppsGuide = null;
      document.getElementById('chat-header-sub').textContent = act.headerSub;
      setActLabel(act.label + '：' + act.title);

      const progMap = { act1: 15, act2: 35, act3: 55, act4: 70, act5: 85 };
      updateProgress(progMap[actKey] || 0);

      const chatBody = document.getElementById('chat-body');
      chatBody.innerHTML = '';
      addDateLabel();
      resetChatAutoFollow();

      showScreen('chat');
      loadScene(scene);
      updateProgress(getProgress());
    }

    // ===========================
    // NEWS → ACT 1
    // ===========================
    function startAct1() {
      showActBreak('act1', function () {
        startAct('act1');
      });
    }

    // ===========================
    // ACT BREAK
    // ===========================
    function showActBreak(actKey, callback) {
      const act = STORY[actKey];
      document.getElementById('break-act-number').textContent = act.label;
      document.getElementById('break-act-title').textContent = act.title;
      document.getElementById('break-act-goal').textContent = act.goal;
      document.getElementById('break-act-time').textContent = act.time;
      document.getElementById('break-facilitator-note').textContent = act.facilNote;
      document.getElementById('btn-act-start').onclick = function () {
        if (callback) callback();
      };
      showScreen('act-break');
    }

    // ===========================
    // CHAT: ACT START
    // ===========================
    function startAct(actKey) {
      currentAct = actKey;
      currentSceneIndex = 0;
      const act = STORY[actKey];
      document.getElementById('chat-header-sub').textContent = act.headerSub;

      const progMap = { act1: 15, act2: 35, act3: 55, act4: 70, act5: 85 };
      updateProgress(progMap[actKey] || 0);
      setActLabel(act.label + '：' + act.title);

      const chatBody = document.getElementById('chat-body');
      chatBody.innerHTML = '';
      addDateLabel();
      resetChatAutoFollow();

      showScreen('chat');
      loadScene(act.scenes[0]);
    }

    function addDateLabel() {
      const div = document.createElement('div');
      div.className = 'chat-date-label animate-in';
      div.innerHTML = '<span>2026年2月23日（月）</span>';
      document.getElementById('chat-body').appendChild(div);
    }

    function addFacilitatorBanner(note) {
      const banner = document.createElement('div');
      banner.className = 'facilitator-banner animate-in';
      banner.innerHTML = `<div class="icon">🎙</div><p><strong>ファシリテーターより：</strong><br>${note}</p>`;
      document.getElementById('chat-body').appendChild(banner);
    }

    // ===========================
    // SCENE LOADING
    // ===========================
    function loadScene(scene) {
      currentScene = scene;
      messageRunId += 1;
      const runId = messageRunId;
      resetChatAutoFollow();

      const chatBody = document.getElementById('chat-body');

      // Scene label
      const lbl = document.createElement('div');
      lbl.className = 'chat-scene-label animate-in';
      lbl.innerHTML = `<span>${scene.label}</span>`;
      chatBody.appendChild(lbl);
      scrollToBottom(true);

      const msgs = scene.messages || (scene.preMessages ? [...scene.preMessages] : []);
      messageQueue = [...msgs];
      showChoiceArea(false);
      showNextMessage(runId);
    }

    function loadNextScene(scene) {
      currentScene = scene;
      messageRunId += 1;
      const runId = messageRunId;
      resetChatAutoFollow();
      const chatBody = document.getElementById('chat-body');

      const lbl = document.createElement('div');
      lbl.className = 'chat-scene-label animate-in';
      lbl.innerHTML = `<span>${scene.label}</span>`;
      chatBody.appendChild(lbl);
      scrollToBottom(true);

      const msgs = scene.preMessages || scene.messages || [];
      messageQueue = [...msgs];
      showChoiceArea(false);
      showNextMessage(runId);
    }

    function showNextMessage(runId = messageRunId) {
      if (runId !== messageRunId) return;

      if (messageQueue.length === 0) {
        setTimeout(() => {
          if (runId !== messageRunId) return;
          if (currentScene && currentScene.autoScreen === 'column-pcat') {
            showColumnPcat(currentScene.nextAct || 'summary');
          } else if (currentScene && currentScene.autoScreen === 'column-legal') {
            showColumnLegal(currentScene.nextAct || 'act3');
          } else if (currentScene && currentScene.choices && currentScene.choices.some(c => c.action === 'column-pcat')) {
            showChoiceArea(true);
            const btnContainer = document.getElementById('choice-buttons');
            btnContainer.innerHTML = '';
            const choiceLabel = document.getElementById('choice-label');
            choiceLabel.textContent = 'どうしますか？';
            currentScene.choices.forEach(c => {
              const btn = document.createElement('button');
              btn.className = 'choice-btn';
              btn.textContent = c.text;
              btn.onclick = () => {
                showColumnPcat(currentScene.nextAct || 'summary');
              };
              btnContainer.appendChild(btn);
            });
            scrollToBottom(true);
          } else {
            showChoiceArea(true);
            scrollToBottom(true);
          }
        }, 400);
        return;
      }

      const msg = messageQueue.shift();
      addMessage(msg);
      scrollToBottom();

      const delay = msg.text.length * 30 + 400;
      setTimeout(() => showNextMessage(runId), Math.min(delay, 1800));
    }

    // ===========================
    // MESSAGE RENDERING
    // ===========================
    const MEKKE_IMAGE_URL = 'clerk.png?v=20260221-1415';
    const SIMULATION_EMBED_URL = 'https://udify.app/chatbot/lDBY9ClRYT3XKx9m';
    const SIMULATION_TAB_URL = 'https://udify.app/chat/lDBY9ClRYT3XKx9m';

    const AVATARS = {
      narrator: { emoji: '📖', label: 'ナレーター', side: 'left' },
      nanta: { emoji: '🐾', label: 'ニャンタ院長', side: 'right' },
      staff: { emoji: '👩‍⚕️', label: 'スタッフ', side: 'left' },
      mekke: { emoji: '🐱', label: 'めっけさん', side: 'left', image: MEKKE_IMAGE_URL },
      patient: { emoji: '🧓', label: '患者さん', side: 'left' },
      system: { emoji: '🚨', label: '緊急情報', side: 'left' }
    };

    function addMessage(msg) {
      const chatBody = document.getElementById('chat-body');
      const av = AVATARS[msg.type] || AVATARS.narrator;
      const avatarHtml = av.image
        ? `<div class="bubble-avatar ${msg.type}"><img src="${av.image}" alt="${av.label}" onerror="this.style.display='none'; this.parentElement.textContent='${av.emoji || '👤'}';"></div>`
        : `<div class="bubble-avatar ${msg.type}">${av.emoji}</div>`;

      const wrap = document.createElement('div');
      wrap.className = `bubble-wrap ${av.side} animate-in`;

      const time = new Date(2026, 1, 23, 10, 45 + Math.floor(Math.random() * 60));
      const timeStr = time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0');

      if (av.side === 'left') {
        wrap.innerHTML = `
      ${avatarHtml}
      <div class="bubble-content">
        <div class="bubble-sender">${av.label}</div>
        <div class="bubble ${av.side} ${msg.type === 'system' ? 'system-msg' : ''}">${msg.text.replace(/\n/g, '<br>')}</div>
        <div class="bubble-time">${timeStr}</div>
      </div>
    `;
      } else {
        wrap.innerHTML = `
      <div class="bubble-content">
        <div class="bubble-sender" style="text-align:right;">${av.label}</div>
        <div class="bubble right" style="float:right; clear:right;">${msg.text.replace(/\n/g, '<br>')}</div>
        <div class="bubble-time">${timeStr}</div>
      </div>
      ${avatarHtml}
    `;
      }

      chatBody.appendChild(wrap);
    }

    // ===========================
    // CHOICE AREA
    // ===========================
    function showChoiceArea(show) {
      const area = document.getElementById('choice-area');
      const btns = document.getElementById('choice-buttons');

      if (!show) {
        area.style.display = 'none';
        return;
      }

      area.style.display = 'block';
      document.getElementById('choice-label').textContent = currentScene.question || '';
      btns.innerHTML = '';

      // 選択肢がない場合、columnまたはnextActに応じたボタンを表示
      if (!currentScene.choices || currentScene.choices.length === 0) {
        const column = currentScene.column;
        const nextAct = currentScene.nextAct || currentScene.nextAfterBCP;

        if (column === 'column-legal') {
          const btn = document.createElement('button');
          btn.className = 'choice-btn';
          btn.innerHTML = '<div style="font-size: 16px;">⚖️ コラム：災害対応の法的枠組みを見る</div>';
          btn.onclick = () => showColumnLegal(nextAct);
          btns.appendChild(btn);
        } else if (column === 'column-pcat') {
          const btn = document.createElement('button');
          btn.className = 'choice-btn';
          btn.innerHTML = '<div style="font-size: 16px;">📋 PCATについてのコラムを見る</div>';
          btn.onclick = () => showColumnPcat(nextAct);
          btns.appendChild(btn);
        } else if (nextAct) {
          const btn = document.createElement('button');
          btn.className = 'choice-btn';
          btn.innerHTML = '<div style="font-size: 16px;">▶ 次へ進む</div>';
          btn.onclick = () => goToNextAct(nextAct);
          btns.appendChild(btn);
        }
        return;
      }

      currentScene.choices.forEach((choice, i) => {
        const btn = document.createElement('button');
        btn.className = `choice-btn ${choice.quality}`;
        btn.innerHTML = `
      <div class="choice-letter">${choice.letter}</div>
      <div>${choice.text}</div>
    `;
        btn.onclick = () => selectChoice(i);
        btns.appendChild(btn);
      });
    }

    // ===========================
    // CHOICE SELECTION → RESULT
    // ===========================
    function selectChoice(index) {
      const choice = currentScene.choices[index];
      showResult(choice, index);
    }

    function showResult(choice, index) {
      const qualityMap = {
        great: { badge: '⭐ より良い選択です！', cls: 'great', title: '素晴らしい判断！' },
        ok: { badge: '👍 悪くない選択', cls: 'good', title: 'まずまずの判断' },
        rethink: { badge: '🤔 もう少し考えてみよう', cls: 'rethink', title: '別の視点を考えてみましょう' }
      };

      const q = qualityMap[choice.quality];
      const badgeEl = document.getElementById('result-badge');
      const titleEl = document.getElementById('result-title');
      const isWorkshopUpload = choice.action === 'open_upload';
      const isWorkshopSimulation = choice.action === 'open_simulation';
      const isWorkshopAction = isWorkshopUpload || isWorkshopSimulation;

      if (isWorkshopAction) {
        badgeEl.style.display = 'none';
        titleEl.textContent = isWorkshopSimulation ? 'シミュレーション' : 'グループワーク';
      } else {
        badgeEl.style.display = 'inline-flex';
        badgeEl.className = `result-badge ${q.cls}`;
        badgeEl.textContent = q.badge;
        titleEl.textContent = q.title;
      }

      const bestChoice = currentScene.choices.find(c => c.quality === 'great');
      const resultImageSrc = isWorkshopSimulation ? MEKKE_IMAGE_URL : `${choice.quality}.png`;
      const resultImageAlt = isWorkshopSimulation ? 'めっけさん' : choice.quality;

      let html = `
    <div style="text-align: center; margin: 16px 0;">
      <!-- 画像挿入ポイント：フィードバックイラスト（${choice.quality}） -->
      <img src="${resultImageSrc}" alt="${resultImageAlt}" style="width: 140px; height: 140px; border-radius: 50%; border: 4px solid ${choice.quality === 'great' ? '#10B981' : choice.quality === 'rethink' ? '#F59E0B' : '#E2E8F0'}; margin: 0 auto; display: block; object-fit: cover; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    </div>
    
    <div class="result-selected ${q.cls}">
      <div class="result-selected-label">あなたの選択</div>
      <div class="result-selected-text">${choice.letter}. ${choice.text}</div>
    </div>

    <div class="result-comment">
      <h3>💬 解説</h3>
      <p>${choice.comment}</p>
    </div>
  `;

      if (choice.quality !== 'great' && choice.bestComment) {
        html += `
      <div class="best-choice-box">
        <h3>✅ より良い選択は？</h3>
        <p>${choice.bestComment}</p>
      </div>
    `;
      }

      // Learning point (last scene of each act)
      if (currentScene.learningPoint) {
        html += `
      <div class="learning-box">
        <h3>📚 学びのポイント</h3>
        <p>${currentScene.learningPoint.replace(/\n/g, '<br>')}</p>
      </div>
    `;
      }

      // Brief primer shown before leaving the contact-tree scene.
      if (currentScene.id === '2-1') {
        html += `
      <div class="learning-box">
        <h3>📡 災害時の連絡ツリーとは？</h3>
        <p>
          「誰が、誰に、何を伝えるか」を平時に決めておく緊急連絡網のことです。<br>
          1人が次の担当者へ順に展開することで、安否・現在地・出勤可否などを短時間で共有できます。<br>
          音声通話が混雑してつながりにくい状況に備え、電話に加えてLINE・SMSなど代替手段もセットで決めておくのがポイントです。
        </p>
      </div>
    `;
      }

      // Next button
      const nextAct = currentScene.nextAct;
      const nextSceneId = currentScene.nextScene;
      let nextButtonHtml = '';

      if (nextAct === 'hazard') {
        const afterBCPAct = currentScene.nextAfterBCP || 'summary';
        if (currentScene.id === '3-2') {
          nextButtonHtml = `<button class="btn-continue" onclick="showColumnVulnerable('hazard')">💊 コラムを読む →</button>`;
        } else {
          nextButtonHtml = `<button class="btn-continue" onclick="goToHazard('${afterBCPAct}')">ハザードマップを確認する →</button>`;
        }
      } else if (nextAct === 'summary') {
        nextButtonHtml = `<button class="btn-continue" onclick="showSummary()">まとめへ進む →</button>`;
      } else if (nextAct) {
        const actKey = nextAct;
        const actLabel = STORY[actKey].label;
        if (currentScene.id === '2-2') {
          nextButtonHtml = `<button class="btn-continue" onclick="showColumnLegal('${actKey}')">⚖️ コラムを読む →</button>`;
        } else if (currentScene.id === '4-2') {
          nextButtonHtml = `<button class="btn-continue" onclick="showColumnMental('${actKey}')">🧠 コラムを読む →</button>`;
        } else if (currentScene.id === '5-1') {
          nextButtonHtml = `<button class="btn-continue" onclick="showColumnPcat('${actKey}')">🤝 コラムを読む →</button>`;
        } else {
          nextButtonHtml = `<button class="btn-continue" onclick="goToNextAct('${actKey}')">グループ内で振り返ったら ${actLabel} へ →</button>`;
        }
      } else if (nextSceneId) {
        if (currentScene.id === '2-1') {
          nextButtonHtml = `<button class="btn-continue" onclick="showColumnPhone()">📞 コラムを読む →</button>`;
        } else if (currentScene.id === '2-info') {
          nextButtonHtml = `<button class="btn-continue" onclick="openDisasterAppsGuide('${nextSceneId}')">防災アプリ紹介へ →</button>`;
        } else if (currentScene.id === '3-1') {
          nextButtonHtml = `<button class="btn-continue" onclick="showColumnBCP('${nextSceneId}')">📋 コラム：BCPを読む →</button>`;
        } else {
          nextButtonHtml = `<button class="btn-continue" onclick="goToNextScene('${nextSceneId}')">次のシーンへ →</button>`;
        }
      }

      if (choice.action === 'open_simulation') {
        const simulationNextButtonHtml = nextButtonHtml.replace('btn-continue', 'btn-continue btn-sim-control');
        const simulationOpenTabHtml = `<a href="${SIMULATION_TAB_URL}" target="_blank" rel="noopener noreferrer" class="btn-continue btn-sim-control btn-sim-open" style="text-decoration:none; text-align:center; margin-bottom:10px;">タブで開く</a>`;
        html += `
      ${simulationOpenTabHtml}
      ${simulationNextButtonHtml}
      <div class="learning-box simulation-embed">
        <iframe
          src="${SIMULATION_EMBED_URL}"
          frameborder="0"
          allow="microphone">
        </iframe>
      </div>
      <div class="simulation-scroll-spacer">ここまで確認したら、上の「次のシーンへ」で進んでください。</div>`;
      } else if (choice.action === 'open_upload') {
        html += `<div style="margin:20px 0;"><a href="https://drive.google.com/drive/folders/19GiNAp9a34pMP2E0POAeSvcqjCSeQhbp?usp=sharing" target="_blank" rel="noopener noreferrer" class="btn-continue" style="background:#10B981; display:block; text-align:center; text-decoration:none;">📁 写真をアップロードする</a></div>`;
      }
      if (choice.action !== 'open_simulation') {
        html += nextButtonHtml;
      }

      document.getElementById('result-body').innerHTML = html;
      showScreen('result');
      updateProgress(getProgress());
    }

    function getProgress() {
      const sceneMap = {
        '1-1': 20, '1-2': 30,
        '2-1': 40, '2-2': 50,
        '3-1': 60, '3-2': 65,
        '4-1': 75, '4-2': 80,
        '5-1': 90
      };
      return sceneMap[currentScene?.id] || 10;
    }

    function goToNextScene(sceneId) {
      const act = STORY[currentAct];
      const scene = act.scenes.find(s => s.id === sceneId);
      if (!scene) return;

      showScreen('chat');

      resetChatAutoFollow();
      showChoiceArea(false);
      loadNextScene(scene);
      scrollToBottom(true);
    }

    let columnBCPNextAct = 'act4';
    let columnLegalNextAct = 'act3';
    let columnMentalNextAct = 'act5';
    let columnPcatNextAct = 'summary';


    function showColumnPcat(nextActKey) {
      columnPcatNextAct = nextActKey || 'summary';
      setActLabel('コラム：支援チームとPCAT');
      showScreen('column-pcat');
    }

    function continueFromColumnPcat() {
      showSummary();
    }

    function showColumnMental(nextActKey) {
      columnMentalNextAct = nextActKey || 'act5';
      setActLabel('コラム：こころのケア');
      showScreen('column-mental');
    }

    function continueFromColumnMental() {
      goToNextAct(columnMentalNextAct);
    }

    function showColumnLegal(nextActKey) {
      columnLegalNextAct = nextActKey || 'act3';
      setActLabel('コラム：災害対応の法的枠組み');
      showScreen('column-legal');
    }

    function continueFromColumnLegal() {
      goToNextAct(columnLegalNextAct);
    }

    function showColumnBCP(nextTarget) {
      columnBCPNextAct = nextTarget || 'act4';
      setActLabel('コラム：BCP（事業継続計画）');
      showScreen('column-bcp');
    }

    function continueFromColumnBCP() {
      // nextTarget がシーンID（例: '3-2'）ならそのシーンへ、それ以外ならハザードへ
      if (columnBCPNextAct && columnBCPNextAct.match(/^\d+-\d+$/)) {
        const act = STORY[currentAct];
        if (act) setActLabel(act.label + '：' + act.title);
        goToNextScene(columnBCPNextAct);
      } else {
        goToHazard(columnBCPNextAct);
      }
    }

    function showColumnPhone() {
      setActLabel('コラム：災害時優先電話');
      showScreen('column-phone');
    }

    let columnVulnerableNextTarget = null;
    function showColumnVulnerable(nextTarget) {
      columnVulnerableNextTarget = nextTarget;
      setActLabel('コラム：要配慮者と「もしものとき」');
      showScreen('column-vulnerable');
    }

    function continueFromColumnVulnerable() {
      const target = columnVulnerableNextTarget || 'act4';
      columnVulnerableNextTarget = null;
      if (target === 'hazard') {
        goToHazard('act4');
      } else if (target.match(/^\d+-\d+$/)) {
        const act = STORY[currentAct];
        if (act) setActLabel(act.label + '：' + act.title);
        goToNextScene(target);
      } else {
        goToNextAct(target);
      }
    }

    function continueFromColumn() {
      if (currentAct && STORY[currentAct]) {
        const act = STORY[currentAct];
        setActLabel(act.label + '：' + act.title);
      }
      goToNextScene('2-info');
    }

    function openDisasterAppsGuide(sceneId) {
      nextSceneAfterAppsGuide = sceneId;
      setActLabel('防災アプリ紹介');
      showScreen('disaster-apps');
    }

    function continueFromDisasterAppsGuide() {
      if (!nextSceneAfterAppsGuide) return;
      const sceneId = nextSceneAfterAppsGuide;
      nextSceneAfterAppsGuide = null;
      const act = STORY[currentAct];
      setActLabel(act.label + '：' + act.title);
      goToNextScene(sceneId);
    }

    function goToNextAct(actKey) {
      showActBreak(actKey, function () {
        startAct(actKey);
      });
    }

    function goToHazard(nextAct = 'summary') {
      nextActAfterBCP = nextAct || 'summary';
      updateProgress(92);
      setActLabel('ハザードマップ確認');
      showScreen('hazard');
    }

    // ===========================
    // BCP SCREEN
    // ===========================
    function showBCP() {
      updateProgress(96);
      setActLabel('BCPチェックリスト');
      renderBCP();
      showScreen('bcp');
    }

    function renderBCP() {
      const body = document.getElementById('bcp-body');
      totalBCPItems = 0;
      let html = '';
      const bcpNextLabel = nextActAfterBCP === 'summary'
        ? 'まとめへ進む →'
        : `${STORY[nextActAfterBCP]?.label || '次の幕'}へ進む →`;

      BCP_DATA.forEach((cat, ci) => {
        totalBCPItems += cat.items.length;
        html += `
      <div class="bcp-category">
        <div class="bcp-cat-header">
          <div class="bcp-cat-icon" style="background:${cat.bg};">${cat.icon}</div>
          <div class="bcp-cat-info">
            <div class="bcp-cat-name">${cat.name}</div>
            <div class="bcp-cat-sub">${cat.sub}</div>
          </div>
        </div>
        <div class="bcp-items">
          ${cat.items.map((item, ii) => {
          const key = `${ci}-${ii}`;
          return `
              <div class="bcp-item" onclick="toggleBCP('${key}')">
                <div class="bcp-checkbox" id="chk-${key}"></div>
                <div class="bcp-item-text">
                  <strong>${item.text}</strong>
                  <span>${item.detail}</span>
                </div>
              </div>
            `;
        }).join('')}
        </div>
      </div>
    `;
      });

      html += `
    <div class="bcp-score-area">
      <div class="bcp-score-label">現在のチェック数</div>
      <div>
        <span class="bcp-score-num" id="bcp-score">0</span>
        <span class="bcp-score-total"> / ${totalBCPItems}</span>
      </div>
      <div class="bcp-score-msg" id="bcp-score-msg">チェックしながら確認してみましょう</div>
    </div>
    <button class="btn-bcp-next" onclick="continueAfterBCP()">${bcpNextLabel}</button>
  `;

      body.innerHTML = html;
    }

    function toggleBCP(key) {
      const chk = document.getElementById('chk-' + key);
      if (!chk) return;

      if (checkedItems[key]) {
        delete checkedItems[key];
        chk.classList.remove('checked');
      } else {
        checkedItems[key] = true;
        chk.classList.add('checked');
      }

      updateBCPScore();
    }

    function updateBCPScore() {
      const count = Object.keys(checkedItems).length;
      document.getElementById('bcp-score').textContent = count;

      const msgs = [
        [0, 3, 'これから整備していきましょう。一つずつ取り組もう！'],
        [4, 7, '少しずつ備えができています。さらに充実させましょう。'],
        [8, 11, 'かなり備えができています！残りを確認してみましょう。'],
        [12, 16, '万全の備えです！ぜひ地域でも共有してください！']
      ];

      for (const [min, max, msg] of msgs) {
        if (count >= min && count <= max) {
          document.getElementById('bcp-score-msg').textContent = msg;
          break;
        }
      }
    }

    // ===========================
    // SUMMARY
    // ===========================
    function showSummary() {
      updateProgress(100);
      setActLabel('まとめ');
      showScreen('summary');
    }

    function drawRoundedRect(ctx, x, y, w, h, r) {
      const rr = Math.min(r, w / 2, h / 2);
      ctx.beginPath();
      ctx.moveTo(x + rr, y);
      ctx.arcTo(x + w, y, x + w, y + h, rr);
      ctx.arcTo(x + w, y + h, x, y + h, rr);
      ctx.arcTo(x, y + h, x, y, rr);
      ctx.arcTo(x, y, x + w, y, rr);
      ctx.closePath();
    }

    function drawWrappedText(ctx, text, x, y, maxWidth, lineHeight, maxLines = null) {
      const lines = [];
      const paragraphs = String(text || '').split('\n');
      paragraphs.forEach((p, pIdx) => {
        if (!p) {
          lines.push('');
          return;
        }
        let line = '';
        for (const ch of p) {
          const test = line + ch;
          if (ctx.measureText(test).width > maxWidth && line) {
            lines.push(line);
            line = ch;
          } else {
            line = test;
          }
        }
        if (line) lines.push(line);
        if (pIdx !== paragraphs.length - 1 && p) lines.push('');
      });

      let out = lines;
      if (maxLines && lines.length > maxLines) {
        out = lines.slice(0, maxLines);
        const last = out[maxLines - 1] || '';
        out[maxLines - 1] = (last.length > 1 ? last.slice(0, -1) : last) + '…';
      }

      out.forEach((line, idx) => {
        ctx.fillText(line, x, y + idx * lineHeight);
      });
      return y + out.length * lineHeight;
    }

    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    async function downloadSummarySnapshotPng() {
      const btn = document.getElementById('btn-save-summary');
      if (!btn) return;
      btn.disabled = true;
      const originalText = btn.textContent;
      btn.textContent = '画像を作成中...';

      try {
        const summaryKeys = Array.from(document.querySelectorAll('#screen-summary .summary-key'))
          .slice(0, 3)
          .map((node, idx) => ({
            num: node.querySelector('.summary-key-num')?.textContent?.trim() || String(idx + 1),
            title: node.querySelector('.summary-key-title')?.textContent?.trim() || '',
            text: node.querySelector('.summary-key-text')?.textContent?.replace(/\s+/g, ' ').trim() || ''
          }));
        const userText = document.getElementById('action-input')?.value?.trim() || '（未入力）';

        const width = 1080;
        const height = 1350;
        const pad = 56;
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        if (!ctx) throw new Error('Canvas not supported');

        /* パステルグラデーション背景 */
        const bg = ctx.createLinearGradient(0, 0, width, height);
        bg.addColorStop(0, '#F0F9FF');
        bg.addColorStop(0.5, '#EDE9FE');
        bg.addColorStop(1, '#FCE7F3');
        ctx.fillStyle = bg;
        ctx.fillRect(0, 0, width, height);

        /* ogp画像（横長バナー） */
        let y = pad;
        try {
          const ogpImg = await loadImage('ogp.png');
          const imgW = width - pad * 2;
          const imgH = 180;
          const imgX = pad;
          ctx.save();
          drawRoundedRect(ctx, imgX, y, imgW, imgH, 20);
          ctx.clip();
          /* 正方形画像を横長にクロップ（やや下寄せ＝上をカット） */
          const scale = imgW / ogpImg.width;
          const drawH = ogpImg.height * scale;
          const drawY = y + (imgH - drawH) * 0.35;
          ctx.drawImage(ogpImg, imgX, drawY, imgW, drawH);
          ctx.restore();
          y += imgH + 16;
        } catch (e) { y += 16; }

        /* タイトル */
        ctx.fillStyle = '#1E293B';
        ctx.font = '900 38px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ワークショップまとめ', width / 2, y + 36);
        ctx.fillStyle = '#64748B';
        ctx.font = '500 22px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
        ctx.fillText('災害への備えをプライマリ・ケア診療に活かす', width / 2, y + 68);
        ctx.textAlign = 'left';
        y += 96;

        /* 3つのキーポイント */
        summaryKeys.forEach((item) => {
          const boxX = pad;
          const boxW = width - pad * 2;
          const boxH = 140;

          drawRoundedRect(ctx, boxX, y, boxW, boxH, 18);
          ctx.fillStyle = 'rgba(255,255,255,0.75)';
          ctx.fill();
          ctx.strokeStyle = 'rgba(0,0,0,0.06)';
          ctx.lineWidth = 1;
          ctx.stroke();

          const badgeSize = 38;
          const badgeX = boxX + 18;
          const badgeY = y + 16;
          ctx.fillStyle = '#F97316';
          ctx.beginPath();
          ctx.arc(badgeX + badgeSize / 2, badgeY + badgeSize / 2, badgeSize / 2, 0, Math.PI * 2);
          ctx.fill();
          ctx.fillStyle = '#FFFFFF';
          ctx.font = '900 22px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(item.num, badgeX + badgeSize / 2, badgeY + badgeSize / 2 + 1);
          ctx.textAlign = 'left';
          ctx.textBaseline = 'alphabetic';

          ctx.fillStyle = '#1E293B';
          ctx.font = '700 24px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
          ctx.fillText(item.title, badgeX + 52, y + 42);

          ctx.fillStyle = '#475569';
          ctx.font = '500 19px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
          drawWrappedText(ctx, item.text, badgeX + 52, y + 72, boxW - 88, 28, 3);

          y += boxH + 14;
        });

        /* アクションプラン */
        y += 6;
        const actionBoxX = pad;
        const actionBoxW = width - pad * 2;
        const actionBoxH = height - y - 70;
        drawRoundedRect(ctx, actionBoxX, y, actionBoxW, actionBoxH, 18);
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.fill();
        ctx.strokeStyle = '#F59E0B';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.fillStyle = '#B45309';
        ctx.font = '700 24px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
        ctx.fillText('✍ あなたのアクションプラン', actionBoxX + 22, y + 38);

        drawRoundedRect(ctx, actionBoxX + 16, y + 56, actionBoxW - 32, actionBoxH - 76, 12);
        ctx.fillStyle = '#FFFBEB';
        ctx.fill();

        ctx.fillStyle = '#1E293B';
        ctx.font = '500 20px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
        drawWrappedText(ctx, userText, actionBoxX + 30, y + 86, actionBoxW - 60, 30, 10);

        /* フッター */
        const now = new Date();
        const stamp = `${now.getFullYear()}/${String(now.getMonth() + 1).padStart(2, '0')}/${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        ctx.fillStyle = '#94A3B8';
        ctx.font = '500 16px "Hiragino Kaku Gothic ProN","Meiryo",sans-serif';
        ctx.fillText(`Generated at ${stamp}`, pad, height - 24);

        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        if (!blob) throw new Error('PNG生成に失敗しました');

        const fileName = `workshop-summary-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}.png`;
        const file = new File([blob], fileName, { type: 'image/png' });

        const isMobile = /iPhone|iPad|Android/i.test(navigator.userAgent);
        let saved = false;
        if (isMobile && navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
          try {
            await navigator.share({
              files: [file],
              title: 'ワークショップまとめ',
              text: 'ワークショップのまとめを保存'
            });
            saved = true;
          } catch (shareErr) {
            if (!shareErr || shareErr.name !== 'AbortError') {
              throw shareErr;
            }
          }
        }

        if (!saved) {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          a.remove();
          setTimeout(() => URL.revokeObjectURL(url), 1000);
          saved = true;
        }

        btn.textContent = '保存しました';
      } catch (err) {
        console.error(err);
        alert('PNGの保存に失敗しました。もう一度お試しください。');
      } finally {
        setTimeout(() => {
          btn.disabled = false;
          btn.textContent = originalText;
        }, 900);
      }
    }

    function continueAfterBCP() {
      const nextAct = nextActAfterBCP || 'summary';
      if (nextAct !== 'summary' && STORY[nextAct]) {
        goToNextAct(nextAct);
        return;
      }
      showSummary();
    }

    // ===========================
    // RESTART
    // ===========================
    function restart() {
      checkedItems = {};
      currentAct = null;
      currentSceneIndex = 0;
      currentScene = null;
      messageQueue = [];
      nextSceneAfterAppsGuide = null;
      nextActAfterBCP = 'summary';
      messageRunId += 1;
      updateProgress(0);
      document.getElementById('action-input').value = '';
      document.getElementById('chat-body').innerHTML = '';
      resetChatAutoFollow();
      showScreen('title');
    }

    // ===========================
    // UTILITIES
    // ===========================
    function isNearBottom(element, threshold = 48) {
      if (!element) return true;
      return (element.scrollHeight - element.clientHeight - element.scrollTop) <= threshold;
    }

    function resetChatAutoFollow() {
      chatAutoFollow = true;
    }

    function setupChatScrollBehavior() {
      const chatScreen = document.getElementById('screen-chat');
      const chatBody = document.getElementById('chat-body');
      const choiceArea = document.getElementById('choice-area');
      if (!chatScreen || !chatBody) return;

      chatBody.addEventListener('scroll', () => {
        if (!chatScreen.classList.contains('active')) return;
        chatAutoFollow = isNearBottom(chatBody);
      }, { passive: true });

      // Allow mouse-wheel scrolling from the chat header area too.
      chatScreen.addEventListener('wheel', (event) => {
        if (!chatScreen.classList.contains('active')) return;
        const target = event.target instanceof Element ? event.target : null;
        if (target && target.closest('#chat-body')) return;
        if (target && choiceArea && choiceArea.contains(target)) return;
        if (chatBody.scrollHeight <= chatBody.clientHeight + 1) return;
        chatBody.scrollTop += event.deltaY;
        event.preventDefault();
      }, { passive: false });
    }

    function scrollToBottom(force = false) {
      const chatBody = document.getElementById('chat-body');
      if (!chatBody) return;
      if (!force && !chatAutoFollow) return;

      const applyBottomScroll = () => {
        chatBody.scrollTop = chatBody.scrollHeight;
      };

      requestAnimationFrame(() => {
        applyBottomScroll();
        requestAnimationFrame(() => {
          applyBottomScroll();
          setTimeout(applyBottomScroll, 140);
        });
      });
    }

    setupChatScrollBehavior();
  </script>
</body>

</html>
